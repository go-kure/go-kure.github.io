<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.155.3"><meta name=generator content="Relearn 8.0.0+9803d5122ebb3276acea823f476e9eb44f607862"><meta name=description content="Launcher Module - Implementation Plan Overview This document provides a detailed implementation plan for the Kurel launcher module, breaking down the work into concrete tasks with specific implementation details.
Phase 1: Core Foundation (Week 1) Task 1.1: Create Base Types and Interfaces Files to create:
pkg/launcher/types.go - Core data structures pkg/launcher/interfaces.go - Public interfaces pkg/launcher/errors.go - Custom error types Key Considerations:
Resources will handle multi-document YAML (each document becomes separate Resource) Need adapter pattern for existing patch.PatchableAppSet integration Resource type must support conversion to/from unstructured.Unstructured Implementation:"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Implementation Plan :: Go Kure"><meta name=twitter:description content="Launcher Module - Implementation Plan Overview This document provides a detailed implementation plan for the Kurel launcher module, breaking down the work into concrete tasks with specific implementation details.
Phase 1: Core Foundation (Week 1) Task 1.1: Create Base Types and Interfaces Files to create:
pkg/launcher/types.go - Core data structures pkg/launcher/interfaces.go - Public interfaces pkg/launcher/errors.go - Custom error types Key Considerations:
Resources will handle multi-document YAML (each document becomes separate Resource) Need adapter pattern for existing patch.PatchableAppSet integration Resource type must support conversion to/from unstructured.Unstructured Implementation:"><meta property="og:url" content="https://www.gokure.dev/packages/launcher/code-implementation-plan/index.html"><meta property="og:site_name" content="Go Kure"><meta property="og:title" content="Implementation Plan :: Go Kure"><meta property="og:description" content="Launcher Module - Implementation Plan Overview This document provides a detailed implementation plan for the Kurel launcher module, breaking down the work into concrete tasks with specific implementation details.
Phase 1: Core Foundation (Week 1) Task 1.1: Create Base Types and Interfaces Files to create:
pkg/launcher/types.go - Core data structures pkg/launcher/interfaces.go - Public interfaces pkg/launcher/errors.go - Custom error types Key Considerations:
Resources will handle multi-document YAML (each document becomes separate Resource) Need adapter pattern for existing patch.PatchableAppSet integration Resource type must support conversion to/from unstructured.Unstructured Implementation:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="Packages"><meta itemprop=name content="Implementation Plan :: Go Kure"><meta itemprop=description content="Launcher Module - Implementation Plan Overview This document provides a detailed implementation plan for the Kurel launcher module, breaking down the work into concrete tasks with specific implementation details.
Phase 1: Core Foundation (Week 1) Task 1.1: Create Base Types and Interfaces Files to create:
pkg/launcher/types.go - Core data structures pkg/launcher/interfaces.go - Public interfaces pkg/launcher/errors.go - Custom error types Key Considerations:
Resources will handle multi-document YAML (each document becomes separate Resource) Need adapter pattern for existing patch.PatchableAppSet integration Resource type must support conversion to/from unstructured.Unstructured Implementation:"><meta itemprop=wordCount content="4140"><title>Implementation Plan :: Go Kure</title><link href=/css/auto-complete/auto-complete.min.css?1770889558 rel=stylesheet><script src=/js/auto-complete/auto-complete.min.js?1770889558 defer></script><script src=/js/search-lunr.min.js?1770889558 defer></script><script src=/js/search.min.js?1770889558 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/searchindex.en.js?1770889558"</script><script src=/js/lunr/lunr.min.js?1770889558 defer></script><script src=/js/lunr/lunr.stemmer.support.min.js?1770889558 defer></script><script src=/js/lunr/lunr.multi.min.js?1770889558 defer></script><script src=/js/lunr/lunr.en.min.js?1770889558 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/fonts/fontawesome/css/fontawesome-all.min.css?1770889558 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/fonts/fontawesome/css/fontawesome-all.min.css?1770889558 rel=stylesheet></noscript><link href=/css/perfect-scrollbar/perfect-scrollbar.min.css?1770889558 rel=stylesheet><link href=/css/theme.min.css?1770889558 rel=stylesheet><link href=/css/format-html.min.css?1770889558 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/packages/launcher/code-implementation-plan/index.html",window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://www.gokure.dev",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["relearn-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><div class="notices warning" style=margin-bottom:1rem><div class=label>‚ö†Ô∏è Work in Progress</div><div class=content>Kure is currently under active development and has not been released yet. APIs and features are subject to change.</div></div></head><body class="mobile-support html" data-url=/packages/launcher/code-implementation-plan/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#phase-1-core-foundation-week-1>Phase 1: Core Foundation (Week 1)</a><ul><li><a href=#task-11-create-base-types-and-interfaces>Task 1.1: Create Base Types and Interfaces</a></li><li><a href=#task-12-implement-package-loader>Task 1.2: Implement Package Loader</a></li></ul></li><li><a href=#phase-2-variable-resolution-week-1-2>Phase 2: Variable Resolution (Week 1-2)</a><ul><li><a href=#task-21-implement-variable-resolver>Task 2.1: Implement Variable Resolver</a></li></ul></li><li><a href=#phase-3-patch-system-week-2>Phase 3: Patch System (Week 2)</a><ul><li><a href=#task-31-implement-patch-discovery-and-dependencies>Task 3.1: Implement Patch Discovery and Dependencies</a></li><li><a href=#task-32-integrate-with-patch-engine>Task 3.2: Integrate with Patch Engine</a></li></ul></li><li><a href=#phase-4-validation-and-schema-week-2-3>Phase 4: Validation and Schema (Week 2-3)</a><ul><li><a href=#task-41-implement-schema-generator>Task 4.1: Implement Schema Generator</a></li><li><a href=#task-42-implement-validator>Task 4.2: Implement Validator</a></li></ul></li><li><a href=#phase-5-output-and-extensions-week-3>Phase 5: Output and Extensions (Week 3)</a><ul><li><a href=#task-51-implement-output-builder>Task 5.1: Implement Output Builder</a></li><li><a href=#task-52-implement-local-extensions>Task 5.2: Implement Local Extensions</a></li></ul></li><li><a href=#phase-6-cli-integration-week-3-4>Phase 6: CLI Integration (Week 3-4)</a><ul><li><a href=#task-61-implement-cli-commands>Task 6.1: Implement CLI Commands</a></li></ul></li><li><a href=#phase-7-testing-week-4>Phase 7: Testing (Week 4)</a><ul><li><a href=#task-71-create-test-fixtures>Task 7.1: Create Test Fixtures</a></li><li><a href=#task-72-write-comprehensive-tests>Task 7.2: Write Comprehensive Tests</a></li></ul></li><li><a href=#implementation-timeline>Implementation Timeline</a><ul><li><a href=#week-1>Week 1</a></li><li><a href=#week-2>Week 2</a></li><li><a href=#week-3>Week 3</a></li><li><a href=#week-4>Week 4</a></li></ul></li><li><a href=#testing-strategy>Testing Strategy</a><ul><li><a href=#unit-tests>Unit Tests</a></li><li><a href=#integration-tests>Integration Tests</a></li><li><a href=#test-data>Test Data</a></li></ul></li><li><a href=#performance-targets>Performance Targets</a></li><li><a href=#key-implementation-notes>Key Implementation Notes</a><ul><li><a href=#security-considerations>Security Considerations</a></li><li><a href=#patch-application-rules>Patch Application Rules</a></li><li><a href=#resource-handling>Resource Handling</a></li><li><a href=#output-modes>Output Modes</a></li></ul></li><li><a href=#documentation-requirements>Documentation Requirements</a><ul><li><a href=#code-documentation>Code Documentation</a></li><li><a href=#user-documentation>User Documentation</a></li></ul></li><li><a href=#success-criteria>Success Criteria</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>Go Kure</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/packages/index.html><span itemprop=name>Packages</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/packages/launcher/index.html><span itemprop=name>Launcher</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Implementation Plan</span><meta itemprop=position content="4"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/packages/launcher/code-design/index.html title="Code Design (ü°ê)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/packages/launcher/architecture/index.html title="Architecture (ü°í)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable packages" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=implementation-plan>Implementation Plan</h1><h1 id=launcher-module---implementation-plan>Launcher Module - Implementation Plan</h1><h2 id=overview>Overview</h2><p>This document provides a detailed implementation plan for the Kurel launcher module, breaking down the work into concrete tasks with specific implementation details.</p><h2 id=phase-1-core-foundation-week-1>Phase 1: Core Foundation (Week 1)</h2><h3 id=task-11-create-base-types-and-interfaces>Task 1.1: Create Base Types and Interfaces</h3><p><strong>Files to create:</strong></p><ul><li><code>pkg/launcher/types.go</code> - Core data structures</li><li><code>pkg/launcher/interfaces.go</code> - Public interfaces</li><li><code>pkg/launcher/errors.go</code> - Custom error types</li></ul><p><strong>Key Considerations:</strong></p><ul><li>Resources will handle multi-document YAML (each document becomes separate Resource)</li><li>Need adapter pattern for existing patch.PatchableAppSet integration</li><li>Resource type must support conversion to/from unstructured.Unstructured</li></ul><p><strong>Implementation:</strong></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// types.go</span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>launcher</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;sync&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;k8s.io/apimachinery/pkg/apis/meta/v1/unstructured&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>metav1</span> <span style=color:#e6db74>&#34;k8s.io/apimachinery/pkg/apis/meta/v1&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>KurelMetadata</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span>        <span style=color:#66d9ef>string</span>   <span style=color:#e6db74>`yaml:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Version</span>     <span style=color:#66d9ef>string</span>   <span style=color:#e6db74>`yaml:&#34;version&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>AppVersion</span>  <span style=color:#66d9ef>string</span>   <span style=color:#e6db74>`yaml:&#34;appVersion&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Description</span> <span style=color:#66d9ef>string</span>   <span style=color:#e6db74>`yaml:&#34;description&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Home</span>        <span style=color:#66d9ef>string</span>   <span style=color:#e6db74>`yaml:&#34;home&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Keywords</span>    []<span style=color:#66d9ef>string</span> <span style=color:#e6db74>`yaml:&#34;keywords&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Schemas</span>     []<span style=color:#66d9ef>string</span> <span style=color:#e6db74>`yaml:&#34;schemas&#34;`</span>  <span style=color:#75715e>// CRD schema URLs</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ParameterMap</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Resource with thread-safe access and unstructured support</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Resource</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>APIVersion</span> <span style=color:#66d9ef>string</span>                     <span style=color:#e6db74>`yaml:&#34;apiVersion&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Kind</span>       <span style=color:#66d9ef>string</span>                     <span style=color:#e6db74>`yaml:&#34;kind&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Metadata</span>   <span style=color:#a6e22e>metav1</span>.<span style=color:#a6e22e>ObjectMeta</span>          <span style=color:#e6db74>`yaml:&#34;metadata&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Raw</span>        <span style=color:#f92672>*</span><span style=color:#a6e22e>unstructured</span>.<span style=color:#a6e22e>Unstructured</span> <span style=color:#75715e>// For patch system compatibility</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mu</span>         <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>RWMutex</span>               <span style=color:#75715e>// Protect concurrent access</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Resource</span>) <span style=color:#a6e22e>GetName</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>RLock</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>RUnlock</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Metadata</span>.<span style=color:#a6e22e>Name</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Resource</span>) <span style=color:#a6e22e>ToUnstructured</span>() (<span style=color:#f92672>*</span><span style=color:#a6e22e>unstructured</span>.<span style=color:#a6e22e>Unstructured</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>RLock</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>RUnlock</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Raw</span>.<span style=color:#a6e22e>DeepCopy</span>(), <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Patch</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span>      <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Path</span>      <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Content</span>   <span style=color:#66d9ef>string</span>         <span style=color:#75715e>// TOML content</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Metadata</span>  <span style=color:#f92672>*</span><span style=color:#a6e22e>PatchMetadata</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>PatchMetadata</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Enabled</span>     <span style=color:#66d9ef>string</span>   <span style=color:#e6db74>`yaml:&#34;enabled&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Description</span> <span style=color:#66d9ef>string</span>   <span style=color:#e6db74>`yaml:&#34;description&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Requires</span>    []<span style=color:#66d9ef>string</span> <span style=color:#e6db74>`yaml:&#34;requires&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Conflicts</span>   []<span style=color:#66d9ef>string</span> <span style=color:#e6db74>`yaml:&#34;conflicts&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>PackageDefinition</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Path</span>       <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Metadata</span>   <span style=color:#a6e22e>KurelMetadata</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Parameters</span> <span style=color:#a6e22e>ParameterMap</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Resources</span>  []<span style=color:#a6e22e>Resource</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Patches</span>    []<span style=color:#a6e22e>Patch</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>PackageInstance</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Definition</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>PackageDefinition</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>UserValues</span> <span style=color:#a6e22e>ParameterMap</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Resolved</span>   <span style=color:#a6e22e>ParameterMap</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>LocalPath</span>  <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// interfaces.go - Small, focused interfaces</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>DefinitionLoader</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>LoadDefinition</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>path</span> <span style=color:#66d9ef>string</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>PackageDefinition</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Resolver</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Resolve</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>base</span>, <span style=color:#a6e22e>overrides</span> <span style=color:#a6e22e>ParameterMap</span>) (<span style=color:#a6e22e>ParameterMap</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Builder</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Build</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>inst</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>PackageInstance</span>, <span style=color:#a6e22e>opts</span> <span style=color:#a6e22e>BuildOptions</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Validator</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ValidateDefinition</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>def</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>PackageDefinition</span>) <span style=color:#a6e22e>ValidationResult</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ValidateInstance</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>inst</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>PackageInstance</span>) <span style=color:#a6e22e>ValidationResult</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Tests to write:</strong></p><ul><li>Type marshaling/unmarshaling tests</li><li>Interface compliance tests</li></ul><h3 id=task-12-implement-package-loader>Task 1.2: Implement Package Loader</h3><p><strong>Files to create:</strong></p><ul><li><code>pkg/launcher/loader.go</code> - Package loading logic</li><li><code>pkg/launcher/loader_test.go</code> - Loader tests</li></ul><p><strong>Implementation details:</strong></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>MaxPackageSize</span>   = <span style=color:#ae81ff>50</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024</span>  <span style=color:#75715e>// 50MB hard limit</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>WarnPackageSize</span>  = <span style=color:#ae81ff>10</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024</span>  <span style=color:#75715e>// 10MB warning</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>MaxResourceCount</span> = <span style=color:#ae81ff>1000</span>               <span style=color:#75715e>// Max resources</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>MaxPatchCount</span>    = <span style=color:#ae81ff>200</span>                <span style=color:#75715e>// Max patches</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>defaultLoader</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fs</span>         <span style=color:#a6e22e>afero</span>.<span style=color:#a6e22e>Fs</span>  <span style=color:#75715e>// For testing with mock filesystem</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>maxSize</span>    <span style=color:#66d9ef>int64</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>maxResources</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>l</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>defaultLoader</span>) <span style=color:#a6e22e>LoadDefinition</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>path</span> <span style=color:#66d9ef>string</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>PackageDefinition</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. Check package size limits</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>l</span>.<span style=color:#a6e22e>validatePackageSize</span>(<span style=color:#a6e22e>path</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;package validation: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. Validate package directory structure</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>l</span>.<span style=color:#a6e22e>validatePackageStructure</span>(<span style=color:#a6e22e>path</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. Load parameters.yaml (critical)</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>params</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>l</span>.<span style=color:#a6e22e>loadParameters</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>path</span>, <span style=color:#e6db74>&#34;parameters.yaml&#34;</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;critical: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 4. Extract metadata from kurel: key</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>metadata</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>extractMetadata</span>(<span style=color:#a6e22e>params</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;invalid metadata: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 5. Load resources with context (best effort)</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>resources</span>, <span style=color:#a6e22e>resourceErrs</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>l</span>.<span style=color:#a6e22e>loadResources</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>path</span>, <span style=color:#e6db74>&#34;resources&#34;</span>))
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 6. Discover and load patches (best effort)</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>patches</span>, <span style=color:#a6e22e>patchErrs</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>l</span>.<span style=color:#a6e22e>loadPatches</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>path</span>, <span style=color:#e6db74>&#34;patches&#34;</span>))
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Check limits</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>resources</span>) &gt; <span style=color:#a6e22e>MaxResourceCount</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;too many resources: %d (max %d)&#34;</span>, len(<span style=color:#a6e22e>resources</span>), <span style=color:#a6e22e>MaxResourceCount</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>patches</span>) &gt; <span style=color:#a6e22e>MaxPatchCount</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;too many patches: %d (max %d)&#34;</span>, len(<span style=color:#a6e22e>patches</span>), <span style=color:#a6e22e>MaxPatchCount</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 7. Collect non-critical errors</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>errs</span> []<span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>errs</span> = append(<span style=color:#a6e22e>errs</span>, <span style=color:#a6e22e>resourceErrs</span><span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>errs</span> = append(<span style=color:#a6e22e>errs</span>, <span style=color:#a6e22e>patchErrs</span><span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>def</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>PackageDefinition</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Path</span>:       <span style=color:#a6e22e>path</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Metadata</span>:   <span style=color:#a6e22e>metadata</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Parameters</span>: <span style=color:#a6e22e>params</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Resources</span>:  <span style=color:#a6e22e>resources</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Patches</span>:    <span style=color:#a6e22e>patches</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>errs</span>) &gt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>def</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>LoadErrors</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>PartialDefinition</span>: <span style=color:#a6e22e>def</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Issues</span>:           <span style=color:#a6e22e>errs</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>def</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>l</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>defaultLoader</span>) <span style=color:#a6e22e>validatePackageSize</span>(<span style=color:#a6e22e>path</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>totalSize</span> <span style=color:#66d9ef>int64</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Walk</span>(<span style=color:#a6e22e>path</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>p</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>info</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>FileInfo</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>totalSize</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>info</span>.<span style=color:#a6e22e>Size</span>()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>totalSize</span> &gt; <span style=color:#a6e22e>MaxPackageSize</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;package exceeds %dMB limit&#34;</span>, <span style=color:#a6e22e>MaxPackageSize</span><span style=color:#f92672>/</span>(<span style=color:#ae81ff>1024</span><span style=color:#f92672>*</span><span style=color:#ae81ff>1024</span>))
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>totalSize</span> &gt; <span style=color:#a6e22e>WarnPackageSize</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Warnf</span>(<span style=color:#e6db74>&#34;Package size %dMB exceeds recommended %dMB&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>totalSize</span><span style=color:#f92672>/</span>(<span style=color:#ae81ff>1024</span><span style=color:#f92672>*</span><span style=color:#ae81ff>1024</span>), <span style=color:#a6e22e>WarnPackageSize</span><span style=color:#f92672>/</span>(<span style=color:#ae81ff>1024</span><span style=color:#f92672>*</span><span style=color:#ae81ff>1024</span>))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Load patches with uniqueness enforcement</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>l</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>defaultLoader</span>) <span style=color:#a6e22e>loadPatchesWithUniqueness</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>path</span> <span style=color:#66d9ef>string</span>) ([]<span style=color:#a6e22e>Patch</span>, []<span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>patches</span> []<span style=color:#a6e22e>Patch</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>errors</span> []<span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>seen</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span>) <span style=color:#75715e>// name -&gt; file path</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Walk</span>(<span style=color:#a6e22e>path</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>p</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>info</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>FileInfo</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>errors</span> = append(<span style=color:#a6e22e>errors</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span> <span style=color:#75715e>// Continue walking</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>HasSuffix</span>(<span style=color:#a6e22e>p</span>, <span style=color:#e6db74>&#34;.kpatch&#34;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>patch</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>l</span>.<span style=color:#a6e22e>loadSinglePatch</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>p</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>errors</span> = append(<span style=color:#a6e22e>errors</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;loading %s: %w&#34;</span>, <span style=color:#a6e22e>p</span>, <span style=color:#a6e22e>err</span>))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Check uniqueness</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>existing</span>, <span style=color:#a6e22e>exists</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>seen</span>[<span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Name</span>]; <span style=color:#a6e22e>exists</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;duplicate patch name &#39;%s&#39; in %s and %s&#34;</span>, 
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>existing</span>, <span style=color:#a6e22e>p</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>seen</span>[<span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Name</span>] = <span style=color:#a6e22e>p</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>patches</span> = append(<span style=color:#a6e22e>patches</span>, <span style=color:#a6e22e>patch</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>errors</span> = append(<span style=color:#a6e22e>errors</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Sort by numeric prefix</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sort</span>.<span style=color:#a6e22e>Slice</span>(<span style=color:#a6e22e>patches</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>j</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>numericPrefixSort</span>(<span style=color:#a6e22e>patches</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>Path</span>, <span style=color:#a6e22e>patches</span>[<span style=color:#a6e22e>j</span>].<span style=color:#a6e22e>Path</span>)
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>patches</span>, <span style=color:#a6e22e>errors</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Key functions to implement:</strong></p><ul><li><code>validatePackageStructure()</code> - Check required directories exist</li><li><code>loadParameters()</code> - Parse parameters.yaml with validation</li><li><code>extractMetadata()</code> - Extract kurel: key from parameters</li><li><code>loadResources()</code> - Discover and parse all resource YAML files (handle multi-document)</li><li><code>loadPatches()</code> - Discover .kpatch files and metadata</li><li><code>sortPatches()</code> - Sort by numeric prefix and path</li><li><code>splitMultiDocument()</code> - Split multi-document YAML into separate Resources</li></ul><p><strong>Tests:</strong></p><ul><li>Valid package loading</li><li>Multi-document YAML handling</li><li>Missing parameters.yaml handling</li><li>Malformed YAML handling</li><li>Patch discovery and ordering</li><li>Error collection for non-critical files</li></ul><h2 id=phase-2-variable-resolution-week-1-2>Phase 2: Variable Resolution (Week 1-2)</h2><h3 id=task-21-implement-variable-resolver>Task 2.1: Implement Variable Resolver</h3><p><strong>Files to create:</strong></p><ul><li><code>pkg/launcher/variables.go</code> - Variable resolution engine</li><li><code>pkg/launcher/variables_test.go</code> - Resolution tests</li></ul><p><strong>Implementation details:</strong></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>defaultResolver</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>maxDepth</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ResolverOption</span> <span style=color:#66d9ef>func</span>(<span style=color:#f92672>*</span><span style=color:#a6e22e>defaultResolver</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>WithMaxDepth</span>(<span style=color:#a6e22e>depth</span> <span style=color:#66d9ef>int</span>) <span style=color:#a6e22e>ResolverOption</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>defaultResolver</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>maxDepth</span> = <span style=color:#a6e22e>depth</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewResolver</span>(<span style=color:#a6e22e>opts</span> <span style=color:#f92672>...</span><span style=color:#a6e22e>ResolverOption</span>) <span style=color:#a6e22e>Resolver</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>defaultResolver</span>{<span style=color:#a6e22e>maxDepth</span>: <span style=color:#ae81ff>10</span>}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>opt</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>opts</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>opt</span>(<span style=color:#a6e22e>r</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>defaultResolver</span>) <span style=color:#a6e22e>Resolve</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>base</span>, <span style=color:#a6e22e>overrides</span> <span style=color:#a6e22e>ParameterMap</span>) (<span style=color:#a6e22e>ParameterMap</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Apply timeout if not already set</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>hasDeadline</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Deadline</span>(); !<span style=color:#a6e22e>hasDeadline</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>cancel</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>CancelFunc</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>cancel</span> = <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithTimeout</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#ae81ff>30</span><span style=color:#f92672>*</span><span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>cancel</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Use goroutine for cancellation support</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>type</span> <span style=color:#a6e22e>result</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>params</span> <span style=color:#a6e22e>ParameterMap</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>err</span>    <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>done</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>result</span>, <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 1. Deep merge parameters</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>merged</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>deepMerge</span>(<span style=color:#a6e22e>base</span>, <span style=color:#a6e22e>overrides</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 2. Extract all variable references</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>refs</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>extractVariableRefs</span>(<span style=color:#a6e22e>merged</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 3. Build dependency graph</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>graph</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>buildDependencyGraph</span>(<span style=color:#a6e22e>refs</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 4. Detect circular dependencies</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>cycles</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>detectCycles</span>(<span style=color:#a6e22e>graph</span>); len(<span style=color:#a6e22e>cycles</span>) &gt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>done</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>result</span>{<span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;circular dependencies: %v&#34;</span>, <span style=color:#a6e22e>cycles</span>)}
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 5. Topological sort for resolution order</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>order</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>topologicalSort</span>(<span style=color:#a6e22e>graph</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 6. Resolve in order</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>resolved</span> <span style=color:#f92672>:=</span> make(<span style=color:#a6e22e>ParameterMap</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>key</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>order</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>value</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>resolveValue</span>(<span style=color:#a6e22e>merged</span>, <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>resolved</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>maxDepth</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>done</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>result</span>{<span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to resolve %s: %w&#34;</span>, <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>err</span>)}
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>resolved</span>[<span style=color:#a6e22e>key</span>] = <span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>done</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>result</span>{<span style=color:#a6e22e>resolved</span>, <span style=color:#66d9ef>nil</span>}
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>res</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>done</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>params</span>, <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Done</span>():
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;variable resolution timeout: %w&#34;</span>, <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Err</span>())
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Key functions:</strong></p><ul><li><code>deepMerge()</code> - Merge parameter maps preserving structure</li><li><code>extractVariableRefs()</code> - Find all ${&mldr;} patterns</li><li><code>buildDependencyGraph()</code> - Create variable dependency DAG</li><li><code>detectCycles()</code> - Find circular dependencies</li><li><code>resolveValue()</code> - Recursively resolve variable value</li><li><code>substituteVariables()</code> - Replace ${&mldr;} with resolved values</li></ul><p><strong>Tests:</strong></p><ul><li>Simple variable substitution</li><li>Nested variable references</li><li>Circular dependency detection</li><li>Maximum depth enforcement</li><li>Missing variable errors</li><li>Complex parameter merging</li></ul><h2 id=phase-3-patch-system-week-2>Phase 3: Patch System (Week 2)</h2><h3 id=task-31-implement-patch-discovery-and-dependencies>Task 3.1: Implement Patch Discovery and Dependencies</h3><p><strong>Files to create:</strong></p><ul><li><code>pkg/launcher/patches.go</code> - Patch processing logic</li><li><code>pkg/launcher/patches_test.go</code> - Patch tests</li></ul><p><strong>Implementation details:</strong></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>patchProcessor</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>logger</span> <span style=color:#a6e22e>Logger</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>patchProcessor</span>) <span style=color:#a6e22e>DiscoverPatches</span>(<span style=color:#a6e22e>patchDir</span> <span style=color:#66d9ef>string</span>) ([]<span style=color:#a6e22e>Patch</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>patches</span> []<span style=color:#a6e22e>Patch</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. Glob for *.kpatch files</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>files</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Glob</span>(<span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>patchDir</span>, <span style=color:#e6db74>&#34;**/*.kpatch&#34;</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. Sort by numeric prefix, then alphabetically</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sort</span>.<span style=color:#a6e22e>Slice</span>(<span style=color:#a6e22e>files</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>j</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>numericPrefixSort</span>(<span style=color:#a6e22e>files</span>[<span style=color:#a6e22e>i</span>], <span style=color:#a6e22e>files</span>[<span style=color:#a6e22e>j</span>])
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. Load each patch and metadata</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>file</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>files</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>patch</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>loadPatch</span>(<span style=color:#a6e22e>file</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span> <span style=color:#75715e>// Collect error, continue loading</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>patches</span> = append(<span style=color:#a6e22e>patches</span>, <span style=color:#a6e22e>patch</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>patches</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>patchProcessor</span>) <span style=color:#a6e22e>ResolveDependencies</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>patches</span> []<span style=color:#a6e22e>Patch</span>, <span style=color:#a6e22e>params</span> <span style=color:#a6e22e>ParameterMap</span>) ([]<span style=color:#a6e22e>Patch</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Check context</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Done</span>():
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Err</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. Evaluate enabled conditions</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>enabled</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>bool</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>patch</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>patches</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Metadata</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Metadata</span>.<span style=color:#a6e22e>Enabled</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>enabled</span>[<span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Name</span>] = <span style=color:#a6e22e>evaluateCondition</span>(<span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Metadata</span>.<span style=color:#a6e22e>Enabled</span>, <span style=color:#a6e22e>params</span>)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>enabled</span>[<span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Name</span>] = <span style=color:#66d9ef>true</span> <span style=color:#75715e>// Default enabled</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. Build dependency graph</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>graph</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>buildPatchDependencyGraph</span>(<span style=color:#a6e22e>patches</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. Auto-enable required patches (with verbose logging)</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>changed</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>changed</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>changed</span> = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>patch</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>patches</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>enabled</span>[<span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Name</span>] <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Metadata</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Metadata</span>.<span style=color:#a6e22e>Requires</span> {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>enabled</span>[<span style=color:#a6e22e>req</span>] {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>verbose</span> {
</span></span><span style=display:flex><span>                            <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Auto-enabling %s (required by %s)&#34;</span>, <span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Name</span>)
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>enabled</span>[<span style=color:#a6e22e>req</span>] = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>changed</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 4. Check for conflicts (fail fast)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>patch</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>patches</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>enabled</span>[<span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Name</span>] {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Metadata</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>conflict</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Metadata</span>.<span style=color:#a6e22e>Conflicts</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>enabled</span>[<span style=color:#a6e22e>conflict</span>] {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;conflict: %s and %s cannot both be enabled&#34;</span>, 
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>conflict</span>)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 5. Filter and sort enabled patches</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>result</span> []<span style=color:#a6e22e>Patch</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>patch</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>patches</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>enabled</span>[<span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Name</span>] {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>result</span> = append(<span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>patch</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Sort by numeric prefix for consistent ordering</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sort</span>.<span style=color:#a6e22e>Slice</span>(<span style=color:#a6e22e>result</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>j</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>numericPrefixSort</span>(<span style=color:#a6e22e>result</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>Path</span>, <span style=color:#a6e22e>result</span>[<span style=color:#a6e22e>j</span>].<span style=color:#a6e22e>Path</span>)
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>result</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Tests:</strong></p><ul><li>Patch discovery with numeric ordering</li><li>Dependency resolution</li><li>Auto-enable behavior</li><li>Conflict detection</li><li>Conditional enabling</li></ul><h3 id=task-32-integrate-with-patch-engine>Task 3.2: Integrate with Patch Engine</h3><p><strong>Files to modify:</strong></p><ul><li><code>pkg/launcher/patches.go</code> - Add apply functionality with adapter</li></ul><p><strong>Implementation:</strong></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Adapter for existing patch system</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>patchEngineAdapter</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>verbose</span> <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>logger</span>  <span style=color:#a6e22e>Logger</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>patchProcessor</span>) <span style=color:#a6e22e>ApplyPatches</span>(<span style=color:#a6e22e>resources</span> []<span style=color:#a6e22e>Resource</span>, <span style=color:#a6e22e>patches</span> []<span style=color:#a6e22e>Patch</span>, <span style=color:#a6e22e>resolved</span> <span style=color:#a6e22e>ParameterMap</span>) ([]<span style=color:#a6e22e>Resource</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>adapter</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>patchEngineAdapter</span>{<span style=color:#a6e22e>verbose</span>: <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>verbose</span>, <span style=color:#a6e22e>logger</span>: <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>logger</span>}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Apply package patches first, then local patches</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>patchDef</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>patches</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 1. Substitute variables in patch content</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>substituted</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>substituteVariables</span>(<span style=color:#a6e22e>patchDef</span>.<span style=color:#a6e22e>Content</span>, <span style=color:#a6e22e>resolved</span>)
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>verbose</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Debug</span>(<span style=color:#e6db74>&#34;Applying patch %s&#34;</span>, <span style=color:#a6e22e>patchDef</span>.<span style=color:#a6e22e>Name</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 2. Convert resources and apply using existing patch system</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>matched</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>resource</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>resources</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>unstructuredRes</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>ToUnstructured</span>()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to convert resource: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>patched</span>, <span style=color:#a6e22e>wasPatched</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>adapter</span>.<span style=color:#a6e22e>ApplyPatch</span>(<span style=color:#a6e22e>unstructuredRes</span>, <span style=color:#a6e22e>substituted</span>, <span style=color:#a6e22e>patchDef</span>.<span style=color:#a6e22e>Name</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Patches MUST succeed or error - no silent failures</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to apply patch %s to %s/%s: %w&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>patchDef</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>Kind</span>, <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>GetName</span>(), <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>wasPatched</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>matched</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>resources</span>[<span style=color:#a6e22e>i</span>] = <span style=color:#a6e22e>FromUnstructured</span>(<span style=color:#a6e22e>patched</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>verbose</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Debug</span>(<span style=color:#e6db74>&#34;Successfully applied patch %s to %s/%s&#34;</span>,
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>patchDef</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>Kind</span>, <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>GetName</span>())
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>matched</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;patch %s matched no resources&#34;</span>, <span style=color:#a6e22e>patchDef</span>.<span style=color:#a6e22e>Name</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>resources</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Adapter method to work with existing patch.PatchableAppSet</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>a</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>patchEngineAdapter</span>) <span style=color:#a6e22e>ApplyPatch</span>(<span style=color:#a6e22e>resource</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>unstructured</span>.<span style=color:#a6e22e>Unstructured</span>, <span style=color:#a6e22e>patchContent</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>patchName</span> <span style=color:#66d9ef>string</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>unstructured</span>.<span style=color:#a6e22e>Unstructured</span>, <span style=color:#66d9ef>bool</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Implementation to bridge to existing patch system</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Will need to study patch.PatchableAppSet usage</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>resource</span>, <span style=color:#66d9ef>false</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=phase-4-validation-and-schema-week-2-3>Phase 4: Validation and Schema (Week 2-3)</h2><h3 id=task-41-implement-schema-generator>Task 4.1: Implement Schema Generator</h3><p><strong>Files to create:</strong></p><ul><li><code>pkg/launcher/schema.go</code> - Schema generation logic</li><li><code>pkg/launcher/schema_test.go</code> - Schema tests</li><li><code>pkg/launcher/schemas/</code> - Bundled K8s schemas</li></ul><p><strong>Implementation:</strong></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>defaultSchemaGenerator</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>bundledSchemas</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#a6e22e>Schema</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tracer</span>         <span style=color:#f92672>*</span><span style=color:#a6e22e>pathTracer</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>g</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>defaultSchemaGenerator</span>) <span style=color:#a6e22e>GenerateSchema</span>(<span style=color:#a6e22e>def</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>PackageDefinition</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>Schema</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>schema</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Schema</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Type</span>: <span style=color:#e6db74>&#34;object&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Properties</span>: make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#a6e22e>SchemaProperty</span>),
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Phase 1: Type inference from parameter values</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>def</span>.<span style=color:#a6e22e>Parameters</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>schema</span>.<span style=color:#a6e22e>Properties</span>[<span style=color:#a6e22e>key</span>] = <span style=color:#a6e22e>inferType</span>(<span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Phase 2: Trace patch paths to K8s fields</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>patch</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>def</span>.<span style=color:#a6e22e>Patches</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>traces</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>g</span>.<span style=color:#a6e22e>tracer</span>.<span style=color:#a6e22e>TracePaths</span>(<span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Content</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>trace</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>traces</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>k8sSchema</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>g</span>.<span style=color:#a6e22e>getK8sSchema</span>(<span style=color:#a6e22e>trace</span>.<span style=color:#a6e22e>ResourceType</span>, <span style=color:#a6e22e>trace</span>.<span style=color:#a6e22e>Field</span>); <span style=color:#a6e22e>k8sSchema</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Enhance parameter schema with K8s constraints</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>enhanceSchema</span>(<span style=color:#a6e22e>schema</span>, <span style=color:#a6e22e>trace</span>.<span style=color:#a6e22e>Variable</span>, <span style=color:#a6e22e>k8sSchema</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Phase 3: Load custom CRD schemas from URLs</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>def</span>.<span style=color:#a6e22e>Metadata</span>.<span style=color:#a6e22e>Schemas</span>) &gt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>url</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>def</span>.<span style=color:#a6e22e>Metadata</span>.<span style=color:#a6e22e>Schemas</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>crdSchema</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fetchSchema</span>(<span style=color:#a6e22e>url</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>continue</span> <span style=color:#75715e>// Log warning, continue</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>g</span>.<span style=color:#a6e22e>bundledSchemas</span>[<span style=color:#a6e22e>crdSchema</span>.<span style=color:#a6e22e>Kind</span>] = <span style=color:#a6e22e>crdSchema</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>schema</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Bundled schemas to include:</strong></p><ul><li>Core K8s resources (Deployment, Service, ConfigMap, etc.)</li><li>Resources from internal/ packages (FluxCD, cert-manager, MetalLB, etc.)</li></ul><h3 id=task-42-implement-validator>Task 4.2: Implement Validator</h3><p><strong>Files to create:</strong></p><ul><li><code>pkg/launcher/validator.go</code> - Validation logic</li><li><code>pkg/launcher/validator_test.go</code> - Validation tests</li></ul><p><strong>Implementation:</strong></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>defaultValidator</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>schemaGen</span> <span style=color:#a6e22e>SchemaGenerator</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>logger</span>    <span style=color:#a6e22e>Logger</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>v</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>defaultValidator</span>) <span style=color:#a6e22e>ValidateDefinition</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>def</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>PackageDefinition</span>) <span style=color:#a6e22e>ValidationResult</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ValidationResult</span>{}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. Validate package structure</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>validateStructure</span>(<span style=color:#a6e22e>def</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Errors</span> = append(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Errors</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. Check patch variable references</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>patch</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>def</span>.<span style=color:#a6e22e>Patches</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>refs</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>extractVariableRefs</span>(<span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Content</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>ref</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>refs</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>parameterExists</span>(<span style=color:#a6e22e>ref</span>, <span style=color:#a6e22e>def</span>.<span style=color:#a6e22e>Parameters</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Errors</span> = append(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Errors</span>, 
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;patch %s: variable %s not defined&#34;</span>, <span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>ref</span>))
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. Validate patch dependencies exist</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>patchNames</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>bool</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>patch</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>def</span>.<span style=color:#a6e22e>Patches</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>patchNames</span>[<span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Name</span>] = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>patch</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>def</span>.<span style=color:#a6e22e>Patches</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Metadata</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>req</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Metadata</span>.<span style=color:#a6e22e>Requires</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>patchNames</span>[<span style=color:#a6e22e>req</span>] {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Errors</span> = append(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Errors</span>,
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;patch %s requires non-existent patch %s&#34;</span>, <span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>req</span>))
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>result</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>v</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>defaultValidator</span>) <span style=color:#a6e22e>ValidateInstance</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>inst</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>PackageInstance</span>) <span style=color:#a6e22e>ValidationResult</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ValidationResult</span>{}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. Validate parameters against schema</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>schema</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>schemaGen</span>.<span style=color:#a6e22e>GenerateSchema</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>inst</span>.<span style=color:#a6e22e>Definition</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Warnings</span> = append(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Warnings</span>, 
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;Could not generate schema: %v&#34;</span>, <span style=color:#a6e22e>err</span>))
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>errs</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>validateAgainstSchema</span>(<span style=color:#a6e22e>inst</span>.<span style=color:#a6e22e>Resolved</span>, <span style=color:#a6e22e>schema</span>); len(<span style=color:#a6e22e>errs</span>) &gt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Errors</span> = append(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Errors</span>, <span style=color:#a6e22e>errs</span><span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. Validate all variables resolve</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>value</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>inst</span>.<span style=color:#a6e22e>Resolved</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Contains</span>(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprint</span>(<span style=color:#a6e22e>value</span>), <span style=color:#e6db74>&#34;${&#34;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Errors</span> = append(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Errors</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;unresolved variable in %s: %v&#34;</span>, <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>value</span>))
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. Validate K8s resources concurrently for performance</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>errors</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>validateResourcesConcurrent</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>inst</span>.<span style=color:#a6e22e>Definition</span>.<span style=color:#a6e22e>Resources</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Errors</span> = append(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Errors</span>, <span style=color:#a6e22e>errors</span><span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>result</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>v</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>defaultValidator</span>) <span style=color:#a6e22e>validateResourcesConcurrent</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>resources</span> []<span style=color:#a6e22e>Resource</span>) []<span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Use worker pool for concurrent validation</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>numWorkers</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>runtime</span>.<span style=color:#a6e22e>NumCPU</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>resources</span>) &lt; <span style=color:#a6e22e>numWorkers</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>numWorkers</span> = len(<span style=color:#a6e22e>resources</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>work</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>int</span>, len(<span style=color:#a6e22e>resources</span>))
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>results</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>error</span>, len(<span style=color:#a6e22e>resources</span>))
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Start workers</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>wg</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>numWorkers</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>idx</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>work</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Done</span>():
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>results</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Err</span>()
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>validateResource</span>(<span style=color:#a6e22e>resources</span>[<span style=color:#a6e22e>idx</span>]); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>results</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;resource %s: %w&#34;</span>, 
</span></span><span style=display:flex><span>                            <span style=color:#a6e22e>resources</span>[<span style=color:#a6e22e>idx</span>].<span style=color:#a6e22e>GetName</span>(), <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Queue work</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>resources</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>work</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>i</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    close(<span style=color:#a6e22e>work</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Collect results</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Wait</span>()
</span></span><span style=display:flex><span>        close(<span style=color:#a6e22e>results</span>)
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>errors</span> []<span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>results</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>errors</span> = append(<span style=color:#a6e22e>errors</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>v</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>defaultValidator</span>) <span style=color:#a6e22e>validateResource</span>(<span style=color:#a6e22e>resource</span> <span style=color:#a6e22e>Resource</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Try full validation with schema</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>schema</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>getK8sSchema</span>(<span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>APIVersion</span>, <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>Kind</span>); <span style=color:#a6e22e>schema</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>validateWithSchema</span>(<span style=color:#a6e22e>resource</span>, <span style=color:#a6e22e>schema</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Fallback to medium validation</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>validateMedium</span>(<span style=color:#a6e22e>resource</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=phase-5-output-and-extensions-week-3>Phase 5: Output and Extensions (Week 3)</h2><h3 id=task-51-implement-output-builder>Task 5.1: Implement Output Builder</h3><p><strong>Files to create:</strong></p><ul><li><code>pkg/launcher/builder.go</code> - Output generation logic</li><li><code>pkg/launcher/builder_test.go</code> - Builder tests</li></ul><p><strong>Implementation:</strong></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>OutputFormat</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>OutputFormatSingle</span>     <span style=color:#a6e22e>OutputFormat</span> = <span style=color:#e6db74>&#34;single&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>OutputFormatByKind</span>     <span style=color:#a6e22e>OutputFormat</span> = <span style=color:#e6db74>&#34;by-kind&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>OutputFormatByResource</span> <span style=color:#a6e22e>OutputFormat</span> = <span style=color:#e6db74>&#34;by-resource&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>OutputType</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>OutputTypeYAML</span> <span style=color:#a6e22e>OutputType</span> = <span style=color:#e6db74>&#34;yaml&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>OutputTypeJSON</span> <span style=color:#a6e22e>OutputType</span> = <span style=color:#e6db74>&#34;json&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>defaultBuilder</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>writer</span> <span style=color:#a6e22e>FileWriter</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>DefaultBuildTimeout</span> = <span style=color:#ae81ff>30</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>  <span style=color:#75715e>// Similar to Helm</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>MaxBuildTimeout</span>     = <span style=color:#ae81ff>5</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Minute</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>b</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>defaultBuilder</span>) <span style=color:#a6e22e>Build</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>inst</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>PackageInstance</span>, <span style=color:#a6e22e>opts</span> <span style=color:#a6e22e>BuildOptions</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Apply timeout if not set</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>hasDeadline</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Deadline</span>(); !<span style=color:#a6e22e>hasDeadline</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>cancel</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>CancelFunc</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>cancel</span> = <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithTimeout</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>DefaultBuildTimeout</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>cancel</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Progress indicator</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>progress</span> <span style=color:#a6e22e>ProgressReporter</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>opts</span>.<span style=color:#a6e22e>ShowProgress</span> <span style=color:#f92672>&amp;&amp;</span> !<span style=color:#a6e22e>opts</span>.<span style=color:#a6e22e>Quiet</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>progress</span> = <span style=color:#a6e22e>NewProgressBar</span>(<span style=color:#e6db74>&#34;Building package...&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>progress</span>.<span style=color:#a6e22e>Finish</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. Apply patches to resources (with transactional behavior)</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>processor</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>newPatchProcessor</span>(<span style=color:#a6e22e>WithVerbose</span>(<span style=color:#a6e22e>opts</span>.<span style=color:#a6e22e>Verbose</span>))
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>progress</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>progress</span>.<span style=color:#a6e22e>Update</span>(<span style=color:#e6db74>&#34;Applying patches...&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>resources</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>processor</span>.<span style=color:#a6e22e>ApplyPatches</span>(<span style=color:#a6e22e>ctx</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>inst</span>.<span style=color:#a6e22e>Definition</span>.<span style=color:#a6e22e>Resources</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>inst</span>.<span style=color:#a6e22e>Definition</span>.<span style=color:#a6e22e>Patches</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>inst</span>.<span style=color:#a6e22e>Resolved</span>,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;patch application failed: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. Sort resources by phase annotations</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>progress</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>progress</span>.<span style=color:#a6e22e>Update</span>(<span style=color:#e6db74>&#34;Organizing resources...&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>phased</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>organizeByPhase</span>(<span style=color:#a6e22e>resources</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. Output based on options</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>progress</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>progress</span>.<span style=color:#a6e22e>Update</span>(<span style=color:#e6db74>&#34;Writing output...&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>opts</span>.<span style=color:#a6e22e>OutputPath</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;-&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Write to stdout (dry-run mode)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>writeToStdout</span>(<span style=color:#a6e22e>resources</span>, <span style=color:#a6e22e>opts</span>.<span style=color:#a6e22e>OutputType</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Write to files</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>writeToFiles</span>(<span style=color:#a6e22e>resources</span>, <span style=color:#a6e22e>opts</span>.<span style=color:#a6e22e>OutputPath</span>, <span style=color:#a6e22e>opts</span>.<span style=color:#a6e22e>OutputFormat</span>, <span style=color:#a6e22e>opts</span>.<span style=color:#a6e22e>OutputType</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>b</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>defaultBuilder</span>) <span style=color:#a6e22e>writeToFiles</span>(<span style=color:#a6e22e>resources</span> []<span style=color:#a6e22e>Resource</span>, <span style=color:#a6e22e>path</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>format</span> <span style=color:#a6e22e>OutputFormat</span>, <span style=color:#a6e22e>outputType</span> <span style=color:#a6e22e>OutputType</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>format</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>OutputFormatSingle</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>writeSingleFile</span>(<span style=color:#a6e22e>resources</span>, <span style=color:#a6e22e>path</span>, <span style=color:#a6e22e>outputType</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>OutputFormatByKind</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>writeByKind</span>(<span style=color:#a6e22e>resources</span>, <span style=color:#a6e22e>path</span>, <span style=color:#a6e22e>outputType</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>OutputFormatByResource</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>writeByResource</span>(<span style=color:#a6e22e>resources</span>, <span style=color:#a6e22e>path</span>, <span style=color:#a6e22e>outputType</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;unknown output format: %s&#34;</span>, <span style=color:#a6e22e>format</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=task-52-implement-local-extensions>Task 5.2: Implement Local Extensions</h3><p><strong>Files to create:</strong></p><ul><li><code>pkg/launcher/extensions.go</code> - Extension handling</li><li><code>pkg/launcher/extensions_test.go</code> - Extension tests</li></ul><p><strong>Implementation:</strong></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>extensionLoader</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>loader</span> <span style=color:#a6e22e>Loader</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>extensionLoader</span>) <span style=color:#a6e22e>LoadWithExtensions</span>(<span style=color:#a6e22e>def</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>PackageDefinition</span>, <span style=color:#a6e22e>localPath</span> <span style=color:#66d9ef>string</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>PackageDefinition</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1. Check if local extension exists</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>localPath</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>localPath</span> = <span style=color:#a6e22e>def</span>.<span style=color:#a6e22e>Path</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.local.kurel&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>exists</span>(<span style=color:#a6e22e>localPath</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>def</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 2. Load local parameters</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>localParams</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>loadLocalParameters</span>(<span style=color:#a6e22e>localPath</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to load local parameters: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 3. Validate parameter compatibility</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>validateParameterCompatibility</span>(<span style=color:#a6e22e>def</span>.<span style=color:#a6e22e>Parameters</span>, <span style=color:#a6e22e>localParams</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;incompatible local parameters: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 4. Load local patches</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>localPatches</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>loadLocalPatches</span>(<span style=color:#a6e22e>localPath</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to load local patches: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 5. Merge with package</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>extended</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>PackageDefinition</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Path</span>:       <span style=color:#a6e22e>def</span>.<span style=color:#a6e22e>Path</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Metadata</span>:   <span style=color:#a6e22e>def</span>.<span style=color:#a6e22e>Metadata</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Parameters</span>: <span style=color:#a6e22e>deepMerge</span>(<span style=color:#a6e22e>def</span>.<span style=color:#a6e22e>Parameters</span>, <span style=color:#a6e22e>localParams</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Resources</span>:  <span style=color:#a6e22e>def</span>.<span style=color:#a6e22e>Resources</span>, <span style=color:#75715e>// Cannot modify resources</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Patches</span>:    append(<span style=color:#a6e22e>def</span>.<span style=color:#a6e22e>Patches</span>, <span style=color:#a6e22e>localPatches</span><span style=color:#f92672>...</span>),
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>extended</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>validateParameterCompatibility</span>(<span style=color:#a6e22e>base</span>, <span style=color:#a6e22e>override</span> <span style=color:#a6e22e>ParameterMap</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>overrideValue</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>override</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>baseValue</span>, <span style=color:#a6e22e>exists</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>base</span>[<span style=color:#a6e22e>key</span>]; <span style=color:#a6e22e>exists</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>compatibleTypes</span>(<span style=color:#a6e22e>baseValue</span>, <span style=color:#a6e22e>overrideValue</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;parameter %s: incompatible type change&#34;</span>, <span style=color:#a6e22e>key</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=phase-6-cli-integration-week-3-4>Phase 6: CLI Integration (Week 3-4)</h2><h3 id=task-61-implement-cli-commands>Task 6.1: Implement CLI Commands</h3><p><strong>Files to modify:</strong></p><ul><li><code>pkg/cmd/kurel/build.go</code> - Build command</li><li><code>pkg/cmd/kurel/validate.go</code> - Validate command</li><li><code>pkg/cmd/kurel/info.go</code> - Info command</li><li><code>pkg/cmd/kurel/schema.go</code> - Schema command</li></ul><p><strong>Build command implementation:</strong></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>newBuildCommand</span>(<span style=color:#a6e22e>globalOpts</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>options</span>.<span style=color:#a6e22e>GlobalOptions</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>cobra</span>.<span style=color:#a6e22e>Command</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> (
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>valuesFile</span>     <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>outputPath</span>     <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>outputFormat</span>   <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>outputType</span>     <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>localPath</span>      <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>verbose</span>        <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>showPatches</span>    <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cmd</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>cobra</span>.<span style=color:#a6e22e>Command</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Use</span>:   <span style=color:#e6db74>&#34;build &lt;package&gt;&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Short</span>: <span style=color:#e6db74>&#34;Build Kubernetes manifests from kurel package&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Args</span>:  <span style=color:#a6e22e>cobra</span>.<span style=color:#a6e22e>ExactArgs</span>(<span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>RunE</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>cmd</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>cobra</span>.<span style=color:#a6e22e>Command</span>, <span style=color:#a6e22e>args</span> []<span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Setup logging</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>setupLogger</span>(<span style=color:#a6e22e>verbose</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Setup context with timeout</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>cancel</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>WithTimeout</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>(), <span style=color:#a6e22e>timeout</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>cancel</span>()
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Progress indication</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>progress</span> <span style=color:#a6e22e>launcher</span>.<span style=color:#a6e22e>ProgressReporter</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>showProgress</span> <span style=color:#f92672>&amp;&amp;</span> !<span style=color:#a6e22e>quiet</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>progress</span> = <span style=color:#a6e22e>launcher</span>.<span style=color:#a6e22e>NewProgressBar</span>(<span style=color:#e6db74>&#34;Loading package...&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>progress</span>.<span style=color:#a6e22e>Finish</span>()
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 1. Load package definition</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Loading package from %s&#34;</span>, <span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>loader</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>launcher</span>.<span style=color:#a6e22e>NewLoader</span>()
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>def</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>loader</span>.<span style=color:#a6e22e>LoadDefinition</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>loadErrs</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>err</span>.(<span style=color:#f92672>*</span><span style=color:#a6e22e>launcher</span>.<span style=color:#a6e22e>LoadErrors</span>); <span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>e</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>loadErrs</span>.<span style=color:#a6e22e>Issues</span> {
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Warn</span>(<span style=color:#e6db74>&#34;Load warning: %v&#34;</span>, <span style=color:#a6e22e>e</span>)
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>def</span> = <span style=color:#a6e22e>loadErrs</span>.<span style=color:#a6e22e>PartialDefinition</span>
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to load package: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 2. Load local extensions</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>localPath</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>exists</span>(<span style=color:#a6e22e>args</span>[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>+</span><span style=color:#e6db74>&#34;.local.kurel&#34;</span>) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Loading local extensions&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>def</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>launcher</span>.<span style=color:#a6e22e>LoadWithExtensions</span>(<span style=color:#a6e22e>def</span>, <span style=color:#a6e22e>localPath</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to load extensions: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 3. Load user values</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>userValues</span> <span style=color:#f92672>:=</span> make(<span style=color:#a6e22e>launcher</span>.<span style=color:#a6e22e>ParameterMap</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>valuesFile</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Loading values from %s&#34;</span>, <span style=color:#a6e22e>valuesFile</span>)
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>userValues</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>loadValuesFile</span>(<span style=color:#a6e22e>valuesFile</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to load values: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 4. Create instance</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>instance</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>launcher</span>.<span style=color:#a6e22e>PackageInstance</span>{
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Definition</span>: <span style=color:#a6e22e>def</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>UserValues</span>: <span style=color:#a6e22e>userValues</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>LocalPath</span>:  <span style=color:#a6e22e>localPath</span>,
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 5. Resolve variables with timeout</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>progress</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>progress</span>.<span style=color:#a6e22e>Update</span>(<span style=color:#e6db74>&#34;Resolving variables...&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Resolving variables&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>resolver</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>launcher</span>.<span style=color:#a6e22e>NewResolver</span>()
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>instance</span>.<span style=color:#a6e22e>Resolved</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>resolver</span>.<span style=color:#a6e22e>Resolve</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>def</span>.<span style=color:#a6e22e>Parameters</span>, <span style=color:#a6e22e>userValues</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to resolve variables: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 6. Process patches</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>progress</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>progress</span>.<span style=color:#a6e22e>Update</span>(<span style=color:#e6db74>&#34;Processing patches...&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Processing patches&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>processor</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>launcher</span>.<span style=color:#a6e22e>NewPatchProcessor</span>(
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>launcher</span>.<span style=color:#a6e22e>WithLogger</span>(<span style=color:#a6e22e>logger</span>),
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>launcher</span>.<span style=color:#a6e22e>WithVerbose</span>(<span style=color:#a6e22e>verbose</span>),
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>enabledPatches</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>processor</span>.<span style=color:#a6e22e>ResolveDependencies</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>def</span>.<span style=color:#a6e22e>Patches</span>, <span style=color:#a6e22e>instance</span>.<span style=color:#a6e22e>Resolved</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to resolve patch dependencies: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>showPatches</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stderr</span>, <span style=color:#e6db74>&#34;Enabled patches:\n&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>p</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>enabledPatches</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprintf</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stderr</span>, <span style=color:#e6db74>&#34;  - %s\n&#34;</span>, <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Name</span>)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 7. Validate with concurrent processing</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>progress</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>progress</span>.<span style=color:#a6e22e>Update</span>(<span style=color:#e6db74>&#34;Validating configuration...&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Validating configuration&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>validator</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>launcher</span>.<span style=color:#a6e22e>NewValidator</span>()
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>validator</span>.<span style=color:#a6e22e>ValidateInstance</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>instance</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>HasErrors</span>() {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Errors</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#e6db74>&#34;Validation error: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;validation failed with %d errors&#34;</span>, len(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Errors</span>))
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>warn</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Warnings</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Warn</span>(<span style=color:#e6db74>&#34;Validation warning: %v&#34;</span>, <span style=color:#a6e22e>warn</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 8. Build output</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>progress</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>progress</span>.<span style=color:#a6e22e>Update</span>(<span style=color:#e6db74>&#34;Building manifests...&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Building manifests&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>builder</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>launcher</span>.<span style=color:#a6e22e>NewBuilder</span>()
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>opts</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>launcher</span>.<span style=color:#a6e22e>BuildOptions</span>{
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>OutputPath</span>:   <span style=color:#a6e22e>outputPath</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>OutputFormat</span>: <span style=color:#a6e22e>launcher</span>.<span style=color:#a6e22e>OutputFormat</span>(<span style=color:#a6e22e>outputFormat</span>),
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>OutputType</span>:   <span style=color:#a6e22e>launcher</span>.<span style=color:#a6e22e>OutputType</span>(<span style=color:#a6e22e>outputType</span>),
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Verbose</span>:      <span style=color:#a6e22e>verbose</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>ShowProgress</span>: <span style=color:#a6e22e>showProgress</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Quiet</span>:        <span style=color:#a6e22e>quiet</span>,
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>outputPath</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>opts</span>.<span style=color:#a6e22e>OutputPath</span> = <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#75715e>// stdout (dry-run)</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>builder</span>.<span style=color:#a6e22e>Build</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>instance</span>, <span style=color:#a6e22e>opts</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;failed to build manifests: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Build complete&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Flags</span>().<span style=color:#a6e22e>StringVarP</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>valuesFile</span>, <span style=color:#e6db74>&#34;values&#34;</span>, <span style=color:#e6db74>&#34;f&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;Values file for overrides&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Flags</span>().<span style=color:#a6e22e>StringVarP</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>outputPath</span>, <span style=color:#e6db74>&#34;output&#34;</span>, <span style=color:#e6db74>&#34;o&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;Output path (default: stdout for dry-run)&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Flags</span>().<span style=color:#a6e22e>StringVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>outputFormat</span>, <span style=color:#e6db74>&#34;format&#34;</span>, <span style=color:#e6db74>&#34;single&#34;</span>, <span style=color:#e6db74>&#34;Output format: single|by-kind|by-resource&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Flags</span>().<span style=color:#a6e22e>StringVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>outputType</span>, <span style=color:#e6db74>&#34;output-format&#34;</span>, <span style=color:#e6db74>&#34;yaml&#34;</span>, <span style=color:#e6db74>&#34;Output type: yaml|json&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Flags</span>().<span style=color:#a6e22e>StringVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>localPath</span>, <span style=color:#e6db74>&#34;local&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;Path to .local.kurel directory&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Flags</span>().<span style=color:#a6e22e>DurationVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>timeout</span>, <span style=color:#e6db74>&#34;timeout&#34;</span>, <span style=color:#a6e22e>DefaultBuildTimeout</span>, <span style=color:#e6db74>&#34;Build timeout&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Flags</span>().<span style=color:#a6e22e>BoolVarP</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>verbose</span>, <span style=color:#e6db74>&#34;verbose&#34;</span>, <span style=color:#e6db74>&#34;v&#34;</span>, <span style=color:#66d9ef>false</span>, <span style=color:#e6db74>&#34;Verbose output with patch debugging&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Flags</span>().<span style=color:#a6e22e>BoolVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>showPatches</span>, <span style=color:#e6db74>&#34;show-patches&#34;</span>, <span style=color:#66d9ef>false</span>, <span style=color:#e6db74>&#34;Show enabled patches&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Flags</span>().<span style=color:#a6e22e>BoolVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>showProgress</span>, <span style=color:#e6db74>&#34;progress&#34;</span>, <span style=color:#66d9ef>true</span>, <span style=color:#e6db74>&#34;Show progress bar&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Flags</span>().<span style=color:#a6e22e>BoolVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>quiet</span>, <span style=color:#e6db74>&#34;quiet&#34;</span>, <span style=color:#66d9ef>false</span>, <span style=color:#e6db74>&#34;Suppress non-essential output&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Flags</span>().<span style=color:#a6e22e>BoolVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>dryRun</span>, <span style=color:#e6db74>&#34;dry-run&#34;</span>, <span style=color:#66d9ef>false</span>, <span style=color:#e6db74>&#34;Print to stdout without writing files&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Mark file/directory flags</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>MarkFlagFilename</span>(<span style=color:#e6db74>&#34;values&#34;</span>, <span style=color:#e6db74>&#34;yaml&#34;</span>, <span style=color:#e6db74>&#34;yml&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>MarkFlagDirname</span>(<span style=color:#e6db74>&#34;output&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>cmd</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=phase-7-testing-week-4>Phase 7: Testing (Week 4)</h2><h3 id=task-71-create-test-fixtures>Task 7.1: Create Test Fixtures</h3><p><strong>Files to create:</strong></p><ul><li><code>pkg/launcher/testdata/packages/simple/</code> - Basic package</li><li><code>pkg/launcher/testdata/packages/complex/</code> - Complex package with patches</li><li><code>pkg/launcher/testdata/packages/invalid/</code> - Invalid packages for error testing</li></ul><h3 id=task-72-write-comprehensive-tests>Task 7.2: Write Comprehensive Tests</h3><p><strong>Test coverage targets:</strong></p><ul><li>Package loading: 90%</li><li>Variable resolution: 95%</li><li>Patch processing: 90%</li><li>Validation: 85%</li><li>Schema generation: 80%</li><li>Output generation: 90%</li></ul><p><strong>Key test scenarios with Go patterns:</strong></p><ol><li><strong>Loader tests (table-driven):</strong></li></ol><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestLoader</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tests</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>name</span>    <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>setup</span>   <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>afero</span>.<span style=color:#a6e22e>Fs</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>wantErr</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    }{
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>name</span>: <span style=color:#e6db74>&#34;valid_package&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>setup</span>: <span style=color:#a6e22e>setupValidPackage</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>name</span>: <span style=color:#e6db74>&#34;missing_parameters&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>setup</span>: <span style=color:#a6e22e>setupMissingParams</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>wantErr</span>: <span style=color:#e6db74>&#34;critical: parameters.yaml&#34;</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>name</span>: <span style=color:#e6db74>&#34;package_too_large&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>setup</span>: <span style=color:#a6e22e>setupLargePackage</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>wantErr</span>: <span style=color:#e6db74>&#34;exceeds 50MB limit&#34;</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>tt</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>tests</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Run</span>(<span style=color:#a6e22e>tt</span>.<span style=color:#a6e22e>name</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fs</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>afero</span>.<span style=color:#a6e22e>NewMemMapFs</span>()
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>tt</span>.<span style=color:#a6e22e>setup</span>(<span style=color:#a6e22e>fs</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>loader</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewLoader</span>(<span style=color:#a6e22e>WithFilesystem</span>(<span style=color:#a6e22e>fs</span>))
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>()
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>loader</span>.<span style=color:#a6e22e>LoadDefinition</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#e6db74>&#34;/test&#34;</span>)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>tt</span>.<span style=color:#a6e22e>wantErr</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>require</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>assert</span>.<span style=color:#a6e22e>Contains</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>(), <span style=color:#a6e22e>tt</span>.<span style=color:#a6e22e>wantErr</span>)
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>require</span>.<span style=color:#a6e22e>NoError</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><ol start=2><li><p><strong>Variable tests:</strong></p><ul><li>Simple substitution</li><li>Nested references</li><li>Circular dependencies</li><li>Missing variables</li><li>Deep merging</li></ul></li><li><p><strong>Patch tests:</strong></p><ul><li>Dependency resolution</li><li>Auto-enabling</li><li>Conflict detection</li><li>Variable substitution in patches</li><li>Patch application failures (must error, not silent)</li><li>Package patch ‚Üí local patch override behavior</li><li>Verbose mode debugging output</li></ul></li><li><p><strong>Validation tests:</strong></p><ul><li>Schema validation</li><li>Resource validation</li><li>Parameter compatibility</li><li>K8s resource constraints</li></ul></li><li><p><strong>Integration tests with benchmarks:</strong></p></li></ol><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestIntegrationBuild</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pkg</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>loadTestPackage</span>(<span style=color:#a6e22e>t</span>, <span style=color:#e6db74>&#34;testdata/packages/complex&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>instance</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>PackageInstance</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Definition</span>: <span style=color:#a6e22e>pkg</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>UserValues</span>: <span style=color:#a6e22e>ParameterMap</span>{<span style=color:#e6db74>&#34;env&#34;</span>: <span style=color:#e6db74>&#34;prod&#34;</span>},
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Test full pipeline</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>resolver</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewResolver</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>instance</span>.<span style=color:#a6e22e>Resolved</span>, <span style=color:#a6e22e>_</span> = <span style=color:#a6e22e>resolver</span>.<span style=color:#a6e22e>Resolve</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>pkg</span>.<span style=color:#a6e22e>Parameters</span>, <span style=color:#a6e22e>instance</span>.<span style=color:#a6e22e>UserValues</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>validator</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewValidator</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>validator</span>.<span style=color:#a6e22e>ValidateInstance</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>instance</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>require</span>.<span style=color:#a6e22e>Empty</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>Errors</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>builder</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>NewBuilder</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>builder</span>.<span style=color:#a6e22e>Build</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>instance</span>, <span style=color:#a6e22e>BuildOptions</span>{})
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>require</span>.<span style=color:#a6e22e>NoError</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>BenchmarkBuildPerformance</span>(<span style=color:#a6e22e>b</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>B</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>targets</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>name</span>      <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>resources</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>target</span>    <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>
</span></span><span style=display:flex><span>    }{
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#34;small&#34;</span>, <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>100</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>},
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#34;medium&#34;</span>, <span style=color:#ae81ff>50</span>, <span style=color:#ae81ff>500</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>},
</span></span><span style=display:flex><span>        {<span style=color:#e6db74>&#34;large&#34;</span>, <span style=color:#ae81ff>200</span>, <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>},
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>tgt</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>targets</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>Run</span>(<span style=color:#a6e22e>tgt</span>.<span style=color:#a6e22e>name</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>b</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>B</span>) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>pkg</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>generatePackage</span>(<span style=color:#a6e22e>tgt</span>.<span style=color:#a6e22e>resources</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>()
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>ResetTimer</span>()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>N</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>start</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>()
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Build</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>pkg</span>, <span style=color:#a6e22e>BuildOptions</span>{})
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>duration</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Since</span>(<span style=color:#a6e22e>start</span>)
</span></span><span style=display:flex><span>                
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>require</span>.<span style=color:#a6e22e>NoError</span>(<span style=color:#a6e22e>b</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>duration</span> &gt; <span style=color:#a6e22e>tgt</span>.<span style=color:#a6e22e>target</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>Fatalf</span>(<span style=color:#e6db74>&#34;exceeded target: %v &gt; %v&#34;</span>, <span style=color:#a6e22e>duration</span>, <span style=color:#a6e22e>tgt</span>.<span style=color:#a6e22e>target</span>)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=implementation-timeline>Implementation Timeline</h2><h3 id=week-1>Week 1</h3><ul><li><input disabled type=checkbox> Core types and interfaces</li><li><input disabled type=checkbox> Package loader</li><li><input disabled type=checkbox> Variable resolver (start)</li></ul><h3 id=week-2>Week 2</h3><ul><li><input disabled type=checkbox> Variable resolver (complete)</li><li><input disabled type=checkbox> Patch discovery and dependencies</li><li><input disabled type=checkbox> Patch application</li></ul><h3 id=week-3>Week 3</h3><ul><li><input disabled type=checkbox> Schema generation</li><li><input disabled type=checkbox> Validation system</li><li><input disabled type=checkbox> Output builder</li><li><input disabled type=checkbox> Local extensions</li></ul><h3 id=week-4>Week 4</h3><ul><li><input disabled type=checkbox> CLI integration</li><li><input disabled type=checkbox> Comprehensive testing</li><li><input disabled type=checkbox> Documentation</li><li><input disabled type=checkbox> Performance optimization</li></ul><h2 id=testing-strategy>Testing Strategy</h2><h3 id=unit-tests>Unit Tests</h3><ul><li>Each module tested in isolation</li><li>Mock dependencies using interfaces</li><li>Table-driven tests for complex logic</li><li>Use <code>testify/assert</code> for assertions</li></ul><h3 id=integration-tests>Integration Tests</h3><ul><li>Full package processing flows</li><li>Real filesystem operations</li><li>End-to-end CLI testing</li><li>Performance benchmarks</li></ul><h3 id=test-data>Test Data</h3><ul><li>Create realistic test packages</li><li>Include edge cases and error conditions</li><li>Test with actual Kubernetes resources</li><li>Validate against real K8s schemas</li></ul><h2 id=performance-targets>Performance Targets</h2><ul><li>Package loading: &lt; 100ms for typical package</li><li>Variable resolution: &lt; 50ms for 100 variables</li><li>Patch application: &lt; 200ms for 50 patches</li><li>Schema generation: &lt; 500ms (with caching)</li><li>Full build: &lt; 1s for typical package</li></ul><h2 id=key-implementation-notes>Key Implementation Notes</h2><h3 id=security-considerations>Security Considerations</h3><ul><li>No direct secret creation - only references (e.g., external-secrets)</li><li>Path traversal protection in package loading</li><li>URL validation for schema URLs</li><li>Sensitive parameter handling - avoid logging sensitive values</li></ul><h3 id=patch-application-rules>Patch Application Rules</h3><ul><li>Patches MUST succeed or return error (no silent failures)</li><li>Application order: Package patches first, then local patches</li><li>Local patches can override package patches</li><li>Verbose mode provides detailed debugging information</li></ul><h3 id=resource-handling>Resource Handling</h3><ul><li>Multi-document YAML files are supported</li><li>Each document becomes a separate Resource object</li><li>Resources need conversion to/from unstructured.Unstructured for patch engine</li></ul><h3 id=output-modes>Output Modes</h3><ul><li>Default stdout output serves as dry-run mode</li><li>File output requires explicit -o flag</li><li>Verbose mode shows patch application details</li></ul><h2 id=documentation-requirements>Documentation Requirements</h2><h3 id=code-documentation>Code Documentation</h3><ul><li>GoDoc comments for all public types and functions</li><li>Example usage in documentation</li><li>Clear error messages with context</li></ul><h3 id=user-documentation>User Documentation</h3><ul><li>Update README.md with launcher usage</li><li>Create examples/ directory with sample packages</li><li>Document all CLI commands and flags</li><li>Provide troubleshooting guide</li></ul><h2 id=success-criteria>Success Criteria</h2><ol><li><strong>Functionality</strong>: All features from design implemented</li><li><strong>Quality</strong>: >85% test coverage, no critical bugs</li><li><strong>Performance</strong>: Meets performance targets</li><li><strong>Usability</strong>: Clear CLI interface with helpful output</li><li><strong>Documentation</strong>: Complete API and user documentation</li><li><strong>Integration</strong>: Seamless integration with existing Kure codebase</li></ol><footer class=footline></footer></article></div></main></div><aside id=R-sidebar class=default-animation><div id=R-header-topbar class=default-animation></div><div id=R-header-wrapper class=default-animation><div id=R-header class=default-animation><a href=https://www.gokure.dev/ style=text-decoration:none><h1 style=margin:0;padding:1rem;color:var(--MENU-SECTIONS-ACTIVE-BG-color)>Go Kure</h1></a><div style="padding:0 1rem 1rem"><div style="background-color:rgba(255,193,7,.1);border:1px solid rgba(255,193,7,.3);border-radius:4px;padding:.75rem"><div style=display:flex;align-items:center;font-weight:700;color:#ffc107;margin-bottom:.25rem;font-size:.9rem><span style=margin-right:.5rem>‚ö†Ô∏è</span>
<span>Pre-Release</span></div><div style=font-size:.8rem;color:#ffeb3b;line-height:1.3>Unreleased software - APIs subject to change</div></div></div></div><search><form action=/search/index.html method=get><div class="searchbox default-animation"><button class=search-detail type=submit title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
<label class=a11y-only for=R-search-by>Search</label>
<input data-search-input id=R-search-by name=search-by class=search-by type=search placeholder=Search...>
<button class=search-clear type=button data-search-clear title="Clear search"><i class="fas fa-times" title="Clear search"></i></button></div></form></search></div><div id=R-homelinks class="default-animation homelinks"><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-homelinks"><ul class="space collapsible-menu"><li data-nav-id=/index.html><a class=padding href=/index.html><i class="fa-fw fas fa-home"></i> Home</a></li></ul></div><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-headercontrols"><ul></ul></div><div class="R-menu-divider default-animation"><hr class=padding></div></div><div id=R-content-wrapper class=highlightable><div class="R-sidebarmenu R-shortcutmenu-main"><ul class="enlarge morespace collapsible-menu"><li data-nav-id=/overview/index.html><a class=padding href=/overview/index.html>Overview</a><ul id=R-subsections-0545e563276d3ac6e3218cfecf67a14b class=collapsible-menu></ul></li><li data-nav-id=/getting-started/index.html><a class=padding href=/getting-started/index.html>Getting Started</a><ul id=R-subsections-87c0363912f379e0725cbe1d504c985c class=collapsible-menu></ul></li><li data-nav-id=/architecture/index.html><a class=padding href=/architecture/index.html>Architecture</a><ul id=R-subsections-9e2fbae00589891720aedcdff0084e07 class=collapsible-menu></ul></li><li class=parent data-nav-id=/packages/index.html><a class=padding href=/packages/index.html>Packages</a><ul id=R-subsections-bdf1e8ce92aa8ff6883c617f10480430 class=collapsible-menu><li class="parent alwaysopen" data-nav-id=/packages/launcher/index.html><a class=padding href=/packages/launcher/index.html>Launcher</a><ul id=R-subsections-9d3dfa62b00c459cf937434644ffeb15 class=collapsible-menu><li data-nav-id=/packages/launcher/readme/index.html><a class=padding href=/packages/launcher/readme/index.html>Overview</a></li><li data-nav-id=/packages/launcher/design/index.html><a class=padding href=/packages/launcher/design/index.html>Design</a></li><li data-nav-id=/packages/launcher/design-details/index.html><a class=padding href=/packages/launcher/design-details/index.html>Design Details</a></li><li data-nav-id=/packages/launcher/code-design/index.html><a class=padding href=/packages/launcher/code-design/index.html>Code Design</a></li><li class=active data-nav-id=/packages/launcher/code-implementation-plan/index.html><a class=padding href=/packages/launcher/code-implementation-plan/index.html>Implementation Plan</a></li><li data-nav-id=/packages/launcher/architecture/index.html><a class=padding href=/packages/launcher/architecture/index.html>Architecture</a></li></ul></li><li class=alwaysopen data-nav-id=/packages/patch/index.html><a class=padding href=/packages/patch/index.html>Patch</a><ul id=R-subsections-7c547ca0c10cfe9e866a079fe02bd5a8 class=collapsible-menu></ul></li><li class=alwaysopen data-nav-id=/packages/stack/index.html><a class=padding href=/packages/stack/index.html>Stack</a><ul id=R-subsections-02bd8df3d763850187342f84e596fe01 class=collapsible-menu></ul></li><li class=alwaysopen data-nav-id=/packages/layout/index.html><a class=padding href=/packages/layout/index.html>Layout</a><ul id=R-subsections-77c3a0c7a55ddc3d5c690813bfe4621c class=collapsible-menu></ul></li><li data-nav-id=/packages/io/index.html><a class=padding href=/packages/io/index.html>IO</a></li><li data-nav-id=/packages/errors/index.html><a class=padding href=/packages/errors/index.html>Errors</a></li><li data-nav-id=/packages/cli/index.html><a class=padding href=/packages/cli/index.html>CLI</a></li></ul></li><li data-nav-id=/examples/index.html><a class=padding href=/examples/index.html>Examples</a><ul id=R-subsections-2e4187ca04853a7e1382c8d86f7be6fd class=collapsible-menu></ul></li><li data-nav-id=/reference/index.html><a class=padding href=/reference/index.html>Reference</a><ul id=R-subsections-66002f201bef818664bb81aa67490c58 class=collapsible-menu></ul></li><li data-nav-id=/development/index.html><a class=padding href=/development/index.html>Development</a><ul id=R-subsections-54b0ce3c97b111c8cd4d107325fd580c class=collapsible-menu></ul></li><li data-nav-id=/changelog/index.html><a class=padding href=/changelog/index.html>Changelog</a><ul id=R-subsections-d1977150cf385e06b32490e43a8e612b class=collapsible-menu></ul></li></ul></div><div class="R-sidebarmenu R-shortcutmenu-shortcuts"><ul class="space collapsible-menu"></ul></div><div id=R-footer-margin></div><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-footercontrols"><ul></ul></div><div id=R-footer><div style="position:sticky;bottom:0;padding:1rem;margin-top:2rem;background-color:rgba(255,193,7,.1);border:1px solid rgba(255,193,7,.3);border-top:3px solid #ffc107"><div style=display:flex;align-items:center;font-weight:700;color:#ffc107;margin-bottom:.5rem><span style=margin-right:.5rem>‚ö†Ô∏è</span>
<span>Pre-Release Software</span></div><div style=font-size:.875rem;color:#ffeb3b;line-height:1.4>This documentation is for unreleased software. Features and APIs may change before the official release.</div></div></div></div></aside><script src=/js/clipboard/clipboard.min.js?1770889558 defer></script><script src=/js/perfect-scrollbar/perfect-scrollbar.min.js?1770889558 defer></script><script src=/js/theme.min.js?1770889558 defer></script></body></html>