<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.155.3"><meta name=generator content="Relearn 8.0.0+9803d5122ebb3276acea823f476e9eb44f607862"><meta name=description content='Stack Module Design Document Last Updated: 2025-08-08
Status: Implemented - Phase 2 Complete
Overview The Stack module provides the core domain model for Kure‚Äôs hierarchical configuration system. It defines a tree structure (Cluster ‚Üí Node ‚Üí Bundle ‚Üí Application) that represents complete Kubernetes deployments organized for GitOps workflows.
Current Architecture Hierarchy Structure The stack follows a four-level hierarchy:
Cluster # Top-level configuration ‚îî‚îÄ‚îÄ Node # Hierarchical packaging unit ‚îî‚îÄ‚îÄ Bundle # Deployment unit (Flux Kustomization) ‚îî‚îÄ‚îÄ Application # Single deployable app Core Components 1. Cluster (pkg/stack/cluster.go) Purpose: Represents complete cluster configuration Contains: Root Node and GitOps bootstrap configuration Current Structure: type Cluster struct { Name string `yaml:"name"` Node *Node `yaml:"node,omitempty"` GitOps *GitOpsConfig `yaml:"gitops,omitempty"` } 2. Node (pkg/stack/cluster.go) Purpose: Hierarchical tree structure for packaging Contains: Bundles and child Nodes Features: Package references for OCI/Git artifacts Hierarchical path management Dependency relationships 3. Bundle (pkg/stack/bundle.go) Purpose: Unit of deployment (maps to Flux Kustomization) Contains: Multiple Applications Features: Flux reconciliation settings (interval, timeout, retryInterval, source) Interval validation (1s to 24h, Go duration format) Dependency management Label propagation 4. Application (pkg/stack/application.go) Purpose: Single deployable application Contains: ApplicationConfig interface Current GVK Support: ‚úÖ Already implemented ApplicationConfig System The ApplicationConfig interface provides pluggable resource generation:'><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Design :: Go Kure"><meta name=twitter:description content='Stack Module Design Document Last Updated: 2025-08-08
Status: Implemented - Phase 2 Complete
Overview The Stack module provides the core domain model for Kure‚Äôs hierarchical configuration system. It defines a tree structure (Cluster ‚Üí Node ‚Üí Bundle ‚Üí Application) that represents complete Kubernetes deployments organized for GitOps workflows.
Current Architecture Hierarchy Structure The stack follows a four-level hierarchy:
Cluster # Top-level configuration ‚îî‚îÄ‚îÄ Node # Hierarchical packaging unit ‚îî‚îÄ‚îÄ Bundle # Deployment unit (Flux Kustomization) ‚îî‚îÄ‚îÄ Application # Single deployable app Core Components 1. Cluster (pkg/stack/cluster.go) Purpose: Represents complete cluster configuration Contains: Root Node and GitOps bootstrap configuration Current Structure: type Cluster struct { Name string `yaml:"name"` Node *Node `yaml:"node,omitempty"` GitOps *GitOpsConfig `yaml:"gitops,omitempty"` } 2. Node (pkg/stack/cluster.go) Purpose: Hierarchical tree structure for packaging Contains: Bundles and child Nodes Features: Package references for OCI/Git artifacts Hierarchical path management Dependency relationships 3. Bundle (pkg/stack/bundle.go) Purpose: Unit of deployment (maps to Flux Kustomization) Contains: Multiple Applications Features: Flux reconciliation settings (interval, timeout, retryInterval, source) Interval validation (1s to 24h, Go duration format) Dependency management Label propagation 4. Application (pkg/stack/application.go) Purpose: Single deployable application Contains: ApplicationConfig interface Current GVK Support: ‚úÖ Already implemented ApplicationConfig System The ApplicationConfig interface provides pluggable resource generation:'><meta property="og:url" content="https://www.gokure.dev/packages/stack/design/index.html"><meta property="og:site_name" content="Go Kure"><meta property="og:title" content="Design :: Go Kure"><meta property="og:description" content='Stack Module Design Document Last Updated: 2025-08-08
Status: Implemented - Phase 2 Complete
Overview The Stack module provides the core domain model for Kure‚Äôs hierarchical configuration system. It defines a tree structure (Cluster ‚Üí Node ‚Üí Bundle ‚Üí Application) that represents complete Kubernetes deployments organized for GitOps workflows.
Current Architecture Hierarchy Structure The stack follows a four-level hierarchy:
Cluster # Top-level configuration ‚îî‚îÄ‚îÄ Node # Hierarchical packaging unit ‚îî‚îÄ‚îÄ Bundle # Deployment unit (Flux Kustomization) ‚îî‚îÄ‚îÄ Application # Single deployable app Core Components 1. Cluster (pkg/stack/cluster.go) Purpose: Represents complete cluster configuration Contains: Root Node and GitOps bootstrap configuration Current Structure: type Cluster struct { Name string `yaml:"name"` Node *Node `yaml:"node,omitempty"` GitOps *GitOpsConfig `yaml:"gitops,omitempty"` } 2. Node (pkg/stack/cluster.go) Purpose: Hierarchical tree structure for packaging Contains: Bundles and child Nodes Features: Package references for OCI/Git artifacts Hierarchical path management Dependency relationships 3. Bundle (pkg/stack/bundle.go) Purpose: Unit of deployment (maps to Flux Kustomization) Contains: Multiple Applications Features: Flux reconciliation settings (interval, timeout, retryInterval, source) Interval validation (1s to 24h, Go duration format) Dependency management Label propagation 4. Application (pkg/stack/application.go) Purpose: Single deployable application Contains: ApplicationConfig interface Current GVK Support: ‚úÖ Already implemented ApplicationConfig System The ApplicationConfig interface provides pluggable resource generation:'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="Packages"><meta itemprop=name content="Design :: Go Kure"><meta itemprop=description content='Stack Module Design Document Last Updated: 2025-08-08
Status: Implemented - Phase 2 Complete
Overview The Stack module provides the core domain model for Kure‚Äôs hierarchical configuration system. It defines a tree structure (Cluster ‚Üí Node ‚Üí Bundle ‚Üí Application) that represents complete Kubernetes deployments organized for GitOps workflows.
Current Architecture Hierarchy Structure The stack follows a four-level hierarchy:
Cluster # Top-level configuration ‚îî‚îÄ‚îÄ Node # Hierarchical packaging unit ‚îî‚îÄ‚îÄ Bundle # Deployment unit (Flux Kustomization) ‚îî‚îÄ‚îÄ Application # Single deployable app Core Components 1. Cluster (pkg/stack/cluster.go) Purpose: Represents complete cluster configuration Contains: Root Node and GitOps bootstrap configuration Current Structure: type Cluster struct { Name string `yaml:"name"` Node *Node `yaml:"node,omitempty"` GitOps *GitOpsConfig `yaml:"gitops,omitempty"` } 2. Node (pkg/stack/cluster.go) Purpose: Hierarchical tree structure for packaging Contains: Bundles and child Nodes Features: Package references for OCI/Git artifacts Hierarchical path management Dependency relationships 3. Bundle (pkg/stack/bundle.go) Purpose: Unit of deployment (maps to Flux Kustomization) Contains: Multiple Applications Features: Flux reconciliation settings (interval, timeout, retryInterval, source) Interval validation (1s to 24h, Go duration format) Dependency management Label propagation 4. Application (pkg/stack/application.go) Purpose: Single deployable application Contains: ApplicationConfig interface Current GVK Support: ‚úÖ Already implemented ApplicationConfig System The ApplicationConfig interface provides pluggable resource generation:'><meta itemprop=wordCount content="1283"><title>Design :: Go Kure</title><link href=/css/auto-complete/auto-complete.min.css?1770906066 rel=stylesheet><script src=/js/auto-complete/auto-complete.min.js?1770906066 defer></script><script src=/js/search-lunr.min.js?1770906066 defer></script><script src=/js/search.min.js?1770906066 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/searchindex.en.js?1770906066"</script><script src=/js/lunr/lunr.min.js?1770906066 defer></script><script src=/js/lunr/lunr.stemmer.support.min.js?1770906066 defer></script><script src=/js/lunr/lunr.multi.min.js?1770906066 defer></script><script src=/js/lunr/lunr.en.min.js?1770906066 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/fonts/fontawesome/css/fontawesome-all.min.css?1770906066 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/fonts/fontawesome/css/fontawesome-all.min.css?1770906066 rel=stylesheet></noscript><link href=/css/perfect-scrollbar/perfect-scrollbar.min.css?1770906066 rel=stylesheet><link href=/css/theme.min.css?1770906066 rel=stylesheet><link href=/css/format-html.min.css?1770906066 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/packages/stack/design/index.html",window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://www.gokure.dev",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["relearn-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><div class="notices warning" style=margin-bottom:1rem><div class=label>‚ö†Ô∏è Work in Progress</div><div class=content>Kure is currently under active development and has not been released yet. APIs and features are subject to change.</div></div></head><body class="mobile-support html" data-url=/packages/stack/design/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#current-architecture>Current Architecture</a><ul><li><a href=#hierarchy-structure>Hierarchy Structure</a></li><li><a href=#core-components>Core Components</a></li><li><a href=#applicationconfig-system>ApplicationConfig System</a></li></ul></li><li><a href=#planned-gvk-integration>Planned GVK Integration</a><ul><li><a href=#motivation>Motivation</a></li><li><a href=#proposed-gvk-design>Proposed GVK Design</a></li><li><a href=#bundle-validation>Bundle Validation</a></li><li><a href=#implementation-architecture>Implementation Architecture</a></li></ul></li><li><a href=#current-workflow-integration>Current Workflow Integration</a><ul><li><a href=#flux-workflow-pkgstackfluxcd>Flux Workflow (<code>pkg/stack/fluxcd/</code>)</a></li><li><a href=#argocd-workflow-pkgstackargocd>ArgoCD Workflow (<code>pkg/stack/argocd/</code>)</a></li><li><a href=#layout-system-pkgstacklayout>Layout System (<code>pkg/stack/layout/</code>)</a></li></ul></li><li><a href=#benefits-of-gvk-integration>Benefits of GVK Integration</a><ul><li><a href=#1-versioned-apis>1. <strong>Versioned APIs</strong></a></li><li><a href=#2-multi-format-support>2. <strong>Multi-Format Support</strong></a></li><li><a href=#3-schema-validation>3. <strong>Schema Validation</strong></a></li><li><a href=#4-tooling-integration>4. <strong>Tooling Integration</strong></a></li><li><a href=#5-future-extensibility>5. <strong>Future Extensibility</strong></a></li></ul></li><li><a href=#compatibility-considerations>Compatibility Considerations</a><ul><li><a href=#backward-compatibility>Backward Compatibility</a></li><li><a href=#migration-path>Migration Path</a></li></ul></li><li><a href=#testing-strategy>Testing Strategy</a><ul><li><a href=#unit-tests>Unit Tests</a></li><li><a href=#integration-tests>Integration Tests</a></li><li><a href=#migration-tests>Migration Tests</a></li></ul></li><li><a href=#future-enhancements>Future Enhancements</a><ul><li><a href=#1-advanced-versioning>1. <strong>Advanced Versioning</strong></a></li><li><a href=#2-schema-management>2. <strong>Schema Management</strong></a></li><li><a href=#3-tooling>3. <strong>Tooling</strong></a></li><li><a href=#4-alternative-stack-models>4. <strong>Alternative Stack Models</strong></a></li></ul></li><li><a href=#implementation-status>Implementation Status</a><ul><li><a href=#phase-1-shared-gvk-infrastructure--complete>Phase 1: Shared GVK Infrastructure ‚úÖ COMPLETE</a></li><li><a href=#phase-2-stack-struct-gvk--complete>Phase 2: Stack Struct GVK ‚úÖ COMPLETE</a></li><li><a href=#phase-3-applicationconfig-refactoring--complete>Phase 3: ApplicationConfig Refactoring ‚úÖ COMPLETE</a></li></ul></li><li><a href=#related-documentation>Related Documentation</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>Go Kure</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/packages/index.html><span itemprop=name>Packages</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/packages/stack/index.html><span itemprop=name>Stack</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Design</span><meta itemprop=position content="4"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/packages/stack/index.html title="Stack (ü°ê)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/packages/stack/generators/index.html title="Generators (ü°í)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable packages" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=design>Design</h1><h1 id=stack-module-design-document>Stack Module Design Document</h1><blockquote><p><strong>Last Updated</strong>: 2025-08-08<br><strong>Status</strong>: Implemented - Phase 2 Complete</p></blockquote><h2 id=overview>Overview</h2><p>The Stack module provides the core domain model for Kure&rsquo;s hierarchical configuration system. It defines a tree structure (Cluster ‚Üí Node ‚Üí Bundle ‚Üí Application) that represents complete Kubernetes deployments organized for GitOps workflows.</p><h2 id=current-architecture>Current Architecture</h2><h3 id=hierarchy-structure>Hierarchy Structure</h3><p>The stack follows a four-level hierarchy:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>Cluster                    # Top-level configuration
‚îî‚îÄ‚îÄ Node                   # Hierarchical packaging unit
    ‚îî‚îÄ‚îÄ Bundle             # Deployment unit (Flux Kustomization)
        ‚îî‚îÄ‚îÄ Application    # Single deployable app</code></pre></div><h3 id=core-components>Core Components</h3><h4 id=1-cluster-pkgstackclustergo>1. Cluster (<code>pkg/stack/cluster.go</code>)</h4><ul><li><strong>Purpose</strong>: Represents complete cluster configuration</li><li><strong>Contains</strong>: Root Node and GitOps bootstrap configuration</li><li><strong>Current Structure</strong>:<div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Cluster</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span>   <span style=color:#66d9ef>string</span>        <span style=color:#e6db74>`yaml:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Node</span>   <span style=color:#f92672>*</span><span style=color:#a6e22e>Node</span>         <span style=color:#e6db74>`yaml:&#34;node,omitempty&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>GitOps</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>GitOpsConfig</span> <span style=color:#e6db74>`yaml:&#34;gitops,omitempty&#34;`</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div></li></ul><h4 id=2-node-pkgstackclustergo>2. Node (<code>pkg/stack/cluster.go</code>)</h4><ul><li><strong>Purpose</strong>: Hierarchical tree structure for packaging</li><li><strong>Contains</strong>: Bundles and child Nodes</li><li><strong>Features</strong>:<ul><li>Package references for OCI/Git artifacts</li><li>Hierarchical path management</li><li>Dependency relationships</li></ul></li></ul><h4 id=3-bundle-pkgstackbundlego>3. Bundle (<code>pkg/stack/bundle.go</code>)</h4><ul><li><strong>Purpose</strong>: Unit of deployment (maps to Flux Kustomization)</li><li><strong>Contains</strong>: Multiple Applications</li><li><strong>Features</strong>:<ul><li>Flux reconciliation settings (interval, timeout, retryInterval, source)</li><li>Interval validation (1s to 24h, Go duration format)</li><li>Dependency management</li><li>Label propagation</li></ul></li></ul><h4 id=4-application-pkgstackapplicationgo>4. Application (<code>pkg/stack/application.go</code>)</h4><ul><li><strong>Purpose</strong>: Single deployable application</li><li><strong>Contains</strong>: ApplicationConfig interface</li><li><strong>Current GVK Support</strong>: ‚úÖ Already implemented</li></ul><h3 id=applicationconfig-system>ApplicationConfig System</h3><p>The ApplicationConfig interface provides pluggable resource generation:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ApplicationConfig</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Generate</span>(<span style=color:#f92672>*</span><span style=color:#a6e22e>Application</span>) ([]<span style=color:#f92672>*</span><span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Object</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Current Generators</strong> (with GVK support):</p><ul><li><code>generators.gokure.dev/v1alpha1/AppWorkload</code> - Standard Kubernetes workloads</li><li><code>generators.gokure.dev/v1alpha1/FluxHelm</code> - Flux HelmRelease resources</li></ul><h2 id=planned-gvk-integration>Planned GVK Integration</h2><h3 id=motivation>Motivation</h3><p>Currently, only the ApplicationConfig layer has GVK versioning. The upper layers (Cluster, Node, Bundle) are unversioned structs, which limits:</p><ol><li><strong>API Evolution</strong>: No clear versioning for schema changes</li><li><strong>Multiple Formats</strong>: Different stack representation approaches</li><li><strong>Tooling Integration</strong>: Different tools may prefer different formats</li><li><strong>Schema Validation</strong>: No OpenAPI schema generation capability</li></ol><h3 id=proposed-gvk-design>Proposed GVK Design</h3><h4 id=api-group-structure>API Group Structure</h4><p><strong>Domain</strong>: <code>stack.gokure.dev</code></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Cluster Configuration</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>stack.gokure.dev/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Cluster</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>production-cluster</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>gitops</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>flux</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>bootstrap</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>fluxVersion</span>: <span style=color:#ae81ff>v2.2.0</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>node</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>root</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># ... node specification</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#75715e># Node Configuration (can be separate artifact)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>stack.gokure.dev/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Node</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>infrastructure</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>flux-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>packageRef</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>infra-packages</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>version</span>: <span style=color:#ae81ff>v1.0.0</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>bundles</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cert-manager</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>ingress-nginx</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>children</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>monitoring</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>packageRef</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#ae81ff>monitoring-packages</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>version</span>: <span style=color:#ae81ff>v2.1.0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#75715e># Bundle Configuration  </span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>stack.gokure.dev/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Bundle</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cert-manager</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>cert-manager</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>interval</span>: <span style=color:#ae81ff>10m</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>sourceRef</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>GitRepository</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>fleet-infra</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>dependsOn</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>crds</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>applications</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>generators.gokure.dev/v1alpha1</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>AppWorkload</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cert-manager</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># ... application config</span></span></span></code></pre></div><h3 id=bundle-validation>Bundle Validation</h3><p>The Stack module includes comprehensive validation for Bundle configurations to ensure GitOps best practices and prevent deployment issues.</p><h4 id=interval-field-validation>Interval Field Validation</h4><p>All time-based fields in Bundle configurations are automatically validated:</p><ul><li><strong><code>interval</code></strong>: GitOps reconciliation frequency</li><li><strong><code>timeout</code></strong>: Maximum wait time for resources to be ready</li><li><strong><code>retryInterval</code></strong>: Frequency for retrying failed reconciliations</li></ul><p><strong>Validation Rules:</strong></p><ul><li><strong>Format</strong>: Must follow Go <code>time.Duration</code> syntax</li><li><strong>Range</strong>: 1 second minimum, 24 hours maximum</li><li><strong>Examples</strong>: <code>"1s"</code>, <code>"5m"</code>, <code>"1h"</code>, <code>"1h30m45s"</code>, <code>"2.5m"</code></li></ul><p><strong>Validation Examples:</strong></p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># ‚úÖ Valid Bundle with proper intervals</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>stack.gokure.dev/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Bundle</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>web-app</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>interval</span>: <span style=color:#e6db74>&#34;10m&#34;</span>        <span style=color:#75715e># Reconcile every 10 minutes</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>timeout</span>: <span style=color:#e6db74>&#34;15m&#34;</span>         <span style=color:#75715e># Wait up to 15 minutes </span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>retryInterval</span>: <span style=color:#e6db74>&#34;2m&#34;</span>    <span style=color:#75715e># Retry every 2 minutes</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#75715e># ‚ùå Invalid Bundle - validation errors</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>stack.gokure.dev/v1alpha1  </span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Bundle</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>invalid-bundle</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>interval</span>: <span style=color:#e6db74>&#34;5 minutes&#34;</span>    <span style=color:#75715e># Error: spaces not allowed</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>timeout</span>: <span style=color:#e6db74>&#34;500ms&#34;</span>         <span style=color:#75715e># Error: too short (minimum 1s)</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>retryInterval</span>: <span style=color:#e6db74>&#34;48h&#34;</span>     <span style=color:#75715e># Error: too long (maximum 24h)</span></span></span></code></pre></div><p><strong>Error Messages:</strong></p><p>Validation failures provide clear, actionable error messages:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>validation error in Bundle &#34;web-app&#34; at spec.interval: 
invalid interval format: &#34;5 minutes&#34;, expected format like &#39;5m&#39;, &#39;1h&#39;, &#39;30s&#39;

validation error in Bundle &#34;web-app&#34; at spec.timeout:
interval &#34;500ms&#34; is too short, minimum is 1s</code></pre></div><h4 id=version-evolution-strategy>Version Evolution Strategy</h4><ul><li><strong>v1alpha1</strong>: Initial implementation, API may change</li><li><strong>v1beta1</strong>: API stabilizing, backward compatibility within beta</li><li><strong>v1</strong>: Stable API, backward compatibility guaranteed</li></ul><h3 id=implementation-architecture>Implementation Architecture</h3><h4 id=shared-gvk-infrastructure>Shared GVK Infrastructure</h4><p>Create <code>internal/gvk</code> package with reusable components:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Generic GVK representation</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>GVK</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Group</span>   <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Version</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Kind</span>    <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Generic registry for any GVK-enabled type</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Registry</span>[<span style=color:#a6e22e>T</span> <span style=color:#66d9ef>any</span>] <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>factories</span> <span style=color:#66d9ef>map</span>[<span style=color:#a6e22e>GVK</span>]<span style=color:#66d9ef>func</span>() <span style=color:#a6e22e>T</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mu</span>        <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>RWMutex</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Generic wrapper for type-aware unmarshaling</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>TypedWrapper</span>[<span style=color:#a6e22e>T</span> <span style=color:#66d9ef>any</span>] <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>APIVersion</span> <span style=color:#66d9ef>string</span>            <span style=color:#e6db74>`yaml:&#34;apiVersion&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Kind</span>       <span style=color:#66d9ef>string</span>            <span style=color:#e6db74>`yaml:&#34;kind&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Metadata</span>   <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>any</span>    <span style=color:#e6db74>`yaml:&#34;metadata&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Spec</span>       <span style=color:#a6e22e>T</span>                 <span style=color:#e6db74>`yaml:&#34;spec&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Common interfaces</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>VersionedType</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>GetAPIVersion</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>GetKind</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h4 id=migration-plan>Migration Plan</h4><p><strong>Phase 1: Create Shared Infrastructure</strong></p><ol><li>Extract generic GVK components to <code>internal/gvk</code></li><li>Update generators to use shared infrastructure</li><li>Add comprehensive tests</li></ol><p><strong>Phase 2: Add GVK to Stack Structs</strong></p><ol><li>Create versioned wrappers for Cluster/Node/Bundle</li><li>Implement custom YAML marshaling/unmarshaling</li><li>Maintain backward compatibility during transition</li></ol><p><strong>Phase 3: Migration & Validation</strong></p><ol><li>Add schema validation for each version</li><li>Create migration utilities for existing configs</li><li>Update documentation and examples</li></ol><h2 id=current-workflow-integration>Current Workflow Integration</h2><h3 id=flux-workflow-pkgstackfluxcd>Flux Workflow (<code>pkg/stack/fluxcd/</code>)</h3><p>The Flux workflow engine generates:</p><ul><li><strong>Bootstrap resources</strong>: Flux system components</li><li><strong>Source resources</strong>: GitRepository, OCIRepository, etc.</li><li><strong>Kustomization resources</strong>: From Bundle configurations</li></ul><h3 id=argocd-workflow-pkgstackargocd>ArgoCD Workflow (<code>pkg/stack/argocd/</code>)</h3><p>The ArgoCD workflow engine generates:</p><ul><li><strong>Application resources</strong>: From Bundle configurations</li><li><strong>AppProject resources</strong>: For grouping and RBAC</li></ul><h3 id=layout-system-pkgstacklayout>Layout System (<code>pkg/stack/layout/</code>)</h3><p>The layout system handles manifest organization:</p><ul><li><strong>Directory structure</strong>: Hierarchical file layout</li><li><strong>Resource grouping</strong>: By namespace, type, or bundle</li><li><strong>Dependency ordering</strong>: Ensuring proper apply sequence</li></ul><h2 id=benefits-of-gvk-integration>Benefits of GVK Integration</h2><h3 id=1-versioned-apis>1. <strong>Versioned APIs</strong></h3><ul><li>Clear schema evolution path</li><li>Backward compatibility guarantees</li><li>Migration tooling support</li></ul><h3 id=2-multi-format-support>2. <strong>Multi-Format Support</strong></h3><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Hierarchical format (current)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>stack.gokure.dev/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Cluster</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>node</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>bundles</span>: [<span style=color:#ae81ff>...]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Flat format (future)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>stack.gokure.dev/v1beta1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterFlat</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>bundles</span>: [<span style=color:#ae81ff>...] </span> <span style=color:#75715e># Direct bundle list</span></span></span></code></pre></div><h3 id=3-schema-validation>3. <strong>Schema Validation</strong></h3><ul><li>OpenAPI schemas for each version</li><li>IDE support with autocompletion</li><li>Runtime validation</li></ul><h3 id=4-tooling-integration>4. <strong>Tooling Integration</strong></h3><ul><li>Different tools can support different versions</li><li>Clear API contracts</li><li>Automated conversion between versions</li></ul><h3 id=5-future-extensibility>5. <strong>Future Extensibility</strong></h3><ul><li>Plugin system for custom stack types</li><li>Alternative hierarchy models</li><li>Integration with external tools</li></ul><h2 id=compatibility-considerations>Compatibility Considerations</h2><h3 id=backward-compatibility>Backward Compatibility</h3><p>During transition, support both formats:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Current direct struct usage</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>cluster</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>stack</span>.<span style=color:#a6e22e>Cluster</span>{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span>: <span style=color:#e6db74>&#34;prod&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Node</span>: <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>stack</span>.<span style=color:#a6e22e>Node</span>{<span style=color:#f92672>...</span>},
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// New GVK-based usage</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>wrapper</span> <span style=color:#a6e22e>stack</span>.<span style=color:#a6e22e>ClusterWrapper</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>yaml</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>data</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>wrapper</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>cluster</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>wrapper</span>.<span style=color:#a6e22e>ToCluster</span>()</span></span></code></pre></div><h3 id=migration-path>Migration Path</h3><ol><li><strong>Phase 1</strong>: Internal infrastructure (no breaking changes)</li><li><strong>Phase 2</strong>: Add GVK support alongside existing APIs</li><li><strong>Phase 3</strong>: Deprecate old APIs (with migration period)</li><li><strong>Phase 4</strong>: Remove old APIs in next major version</li></ol><h2 id=testing-strategy>Testing Strategy</h2><h3 id=unit-tests>Unit Tests</h3><ul><li>GVK parsing and generation</li><li>Registry functionality</li><li>Wrapper marshaling/unmarshaling</li><li>Version compatibility</li></ul><h3 id=integration-tests>Integration Tests</h3><ul><li>Full stack configuration parsing</li><li>Workflow engine compatibility</li><li>Layout generation with GVK structs</li></ul><h3 id=migration-tests>Migration Tests</h3><ul><li>Conversion between formats</li><li>Backward compatibility</li><li>Schema validation</li></ul><h2 id=future-enhancements>Future Enhancements</h2><h3 id=1-advanced-versioning>1. <strong>Advanced Versioning</strong></h3><ul><li>Conversion webhooks for Kubernetes-style migration</li><li>Automatic version detection and upgrade</li><li>Version-specific optimizations</li></ul><h3 id=2-schema-management>2. <strong>Schema Management</strong></h3><ul><li>OpenAPI schema generation</li><li>JSON Schema validation</li><li>Documentation generation from schemas</li></ul><h3 id=3-tooling>3. <strong>Tooling</strong></h3><ul><li>CLI commands for version management</li><li>Migration utilities</li><li>Validation tools</li></ul><h3 id=4-alternative-stack-models>4. <strong>Alternative Stack Models</strong></h3><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># GitOps-native stack (future)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>stack.gokure.dev/v2alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>GitOpsStack</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>repositories</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>url</span>: <span style=color:#ae81ff>github.com/org/infra</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>path</span>: <span style=color:#ae81ff>clusters/prod</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>kustomizations</span>: [<span style=color:#ae81ff>...]</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>helmReleases</span>: [<span style=color:#ae81ff>...]</span></span></span></code></pre></div><h2 id=implementation-status>Implementation Status</h2><h3 id=phase-1-shared-gvk-infrastructure--complete>Phase 1: Shared GVK Infrastructure ‚úÖ COMPLETE</h3><p>Successfully created <code>internal/gvk</code> package with:</p><ul><li>Generic registry using Go generics</li><li>Type-safe factory patterns</li><li>YAML unmarshaling with automatic type detection</li><li>Version conversion framework</li><li>Comprehensive test coverage</li></ul><p><strong>Files Created:</strong></p><ul><li><code>internal/gvk/types.go</code> - Core GVK types and interfaces</li><li><code>internal/gvk/registry.go</code> - Generic registry implementation</li><li><code>internal/gvk/wrapper.go</code> - TypedWrapper for YAML unmarshaling</li><li><code>internal/gvk/parsing.go</code> - YAML parsing utilities</li><li><code>internal/gvk/conversion.go</code> - Version conversion infrastructure</li></ul><h3 id=phase-2-stack-struct-gvk--complete>Phase 2: Stack Struct GVK ‚úÖ COMPLETE</h3><p>Implemented versioned stack types in <code>pkg/stack/v1alpha1</code>:</p><ul><li><strong>ClusterV1Alpha1</strong>: Versioned cluster configuration with GitOps support</li><li><strong>NodeV1Alpha1</strong>: Hierarchical node structure with bundles</li><li><strong>BundleV1Alpha1</strong>: Application bundle with dependencies</li></ul><p><strong>Key Features:</strong></p><ul><li>Full GVK support (apiVersion: stack.gokure.dev/v1alpha1)</li><li>Conversion to unversioned types for backward compatibility</li><li>Multi-document YAML parsing</li><li>Nested resource support (inline and references)</li><li>Comprehensive test coverage</li></ul><p><strong>Files Created:</strong></p><ul><li><code>pkg/stack/v1alpha1/types.go</code> - Versioned type definitions</li><li><code>pkg/stack/v1alpha1/register.go</code> - Registration and factory</li><li><code>pkg/stack/v1alpha1/parser.go</code> - YAML parsing utilities</li><li><code>pkg/stack/v1alpha1/types_test.go</code> - Complete test suite</li></ul><h3 id=phase-3-applicationconfig-refactoring--complete>Phase 3: ApplicationConfig Refactoring ‚úÖ COMPLETE</h3><ul><li>Refactored generators to use <code>internal/gvk</code> infrastructure</li><li>Updated ApplicationWrapper to eliminate circular dependencies</li><li>Maintained full backward compatibility</li><li>All tests passing</li></ul><h2 id=related-documentation>Related Documentation</h2><ul><li><a href=generators/DESIGN/><code>generators/DESIGN.md</code></a>
- ApplicationConfig generator system</li><li><a href=layout/README/><code>layout/README.md</code></a>
- Manifest layout and organization</li><li><a href=fluxcd/README/><code>fluxcd/README.md</code></a>
- Flux workflow integration</li><li><a href=argocd/README/><code>argocd/README.md</code></a>
- ArgoCD workflow integration</li></ul><hr><p><em>This design document is a living document that will be updated as the implementation progresses.</em></p><footer class=footline></footer></article></div></main></div><aside id=R-sidebar class=default-animation><div id=R-header-topbar class=default-animation></div><div id=R-header-wrapper class=default-animation><div id=R-header class=default-animation><a href=https://www.gokure.dev/ style=text-decoration:none><h1 style=margin:0;padding:1rem;color:var(--MENU-SECTIONS-ACTIVE-BG-color)>Go Kure</h1></a><div style="padding:0 1rem 1rem"><div style="background-color:rgba(255,193,7,.1);border:1px solid rgba(255,193,7,.3);border-radius:4px;padding:.75rem"><div style=display:flex;align-items:center;font-weight:700;color:#ffc107;margin-bottom:.25rem;font-size:.9rem><span style=margin-right:.5rem>‚ö†Ô∏è</span>
<span>Pre-Release</span></div><div style=font-size:.8rem;color:#ffeb3b;line-height:1.3>Unreleased software - APIs subject to change</div></div></div></div><search><form action=/search/index.html method=get><div class="searchbox default-animation"><button class=search-detail type=submit title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
<label class=a11y-only for=R-search-by>Search</label>
<input data-search-input id=R-search-by name=search-by class=search-by type=search placeholder=Search...>
<button class=search-clear type=button data-search-clear title="Clear search"><i class="fas fa-times" title="Clear search"></i></button></div></form></search></div><div id=R-homelinks class="default-animation homelinks"><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-homelinks"><ul class="space collapsible-menu"><li data-nav-id=/index.html><a class=padding href=/index.html><i class="fa-fw fas fa-home"></i> Home</a></li></ul></div><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-headercontrols"><ul></ul></div><div class="R-menu-divider default-animation"><hr class=padding></div></div><div id=R-content-wrapper class=highlightable><div class="R-sidebarmenu R-shortcutmenu-main"><ul class="enlarge morespace collapsible-menu"><li data-nav-id=/overview/index.html><a class=padding href=/overview/index.html>Overview</a><ul id=R-subsections-0545e563276d3ac6e3218cfecf67a14b class=collapsible-menu></ul></li><li data-nav-id=/getting-started/index.html><a class=padding href=/getting-started/index.html>Getting Started</a><ul id=R-subsections-87c0363912f379e0725cbe1d504c985c class=collapsible-menu></ul></li><li data-nav-id=/architecture/index.html><a class=padding href=/architecture/index.html>Architecture</a><ul id=R-subsections-9e2fbae00589891720aedcdff0084e07 class=collapsible-menu></ul></li><li class=parent data-nav-id=/packages/index.html><a class=padding href=/packages/index.html>Packages</a><ul id=R-subsections-bdf1e8ce92aa8ff6883c617f10480430 class=collapsible-menu><li class=alwaysopen data-nav-id=/packages/launcher/index.html><a class=padding href=/packages/launcher/index.html>Launcher</a><ul id=R-subsections-9d3dfa62b00c459cf937434644ffeb15 class=collapsible-menu></ul></li><li class=alwaysopen data-nav-id=/packages/patch/index.html><a class=padding href=/packages/patch/index.html>Patch</a><ul id=R-subsections-7c547ca0c10cfe9e866a079fe02bd5a8 class=collapsible-menu></ul></li><li class="parent alwaysopen" data-nav-id=/packages/stack/index.html><a class=padding href=/packages/stack/index.html>Stack</a><ul id=R-subsections-02bd8df3d763850187342f84e596fe01 class=collapsible-menu><li class=active data-nav-id=/packages/stack/design/index.html><a class=padding href=/packages/stack/design/index.html>Design</a></li><li class=alwaysopen data-nav-id=/packages/stack/generators/index.html><a class=padding href=/packages/stack/generators/index.html>Generators</a><ul id=R-subsections-1a1d9b6365e2b30cbf8e233062d0c596 class=collapsible-menu></ul></li><li data-nav-id=/packages/stack/status/index.html><a class=padding href=/packages/stack/status/index.html>Status</a></li></ul></li><li class=alwaysopen data-nav-id=/packages/layout/index.html><a class=padding href=/packages/layout/index.html>Layout</a><ul id=R-subsections-77c3a0c7a55ddc3d5c690813bfe4621c class=collapsible-menu></ul></li><li data-nav-id=/packages/io/index.html><a class=padding href=/packages/io/index.html>IO</a></li><li data-nav-id=/packages/errors/index.html><a class=padding href=/packages/errors/index.html>Errors</a></li><li data-nav-id=/packages/cli/index.html><a class=padding href=/packages/cli/index.html>CLI</a></li></ul></li><li data-nav-id=/examples/index.html><a class=padding href=/examples/index.html>Examples</a><ul id=R-subsections-2e4187ca04853a7e1382c8d86f7be6fd class=collapsible-menu></ul></li><li data-nav-id=/reference/index.html><a class=padding href=/reference/index.html>Reference</a><ul id=R-subsections-66002f201bef818664bb81aa67490c58 class=collapsible-menu></ul></li><li data-nav-id=/development/index.html><a class=padding href=/development/index.html>Development</a><ul id=R-subsections-54b0ce3c97b111c8cd4d107325fd580c class=collapsible-menu></ul></li><li data-nav-id=/changelog/index.html><a class=padding href=/changelog/index.html>Changelog</a><ul id=R-subsections-d1977150cf385e06b32490e43a8e612b class=collapsible-menu></ul></li></ul></div><div class="R-sidebarmenu R-shortcutmenu-shortcuts"><ul class="space collapsible-menu"></ul></div><div id=R-footer-margin></div><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-footercontrols"><ul></ul></div><div id=R-footer><div style="position:sticky;bottom:0;padding:1rem;margin-top:2rem;background-color:rgba(255,193,7,.1);border:1px solid rgba(255,193,7,.3);border-top:3px solid #ffc107"><div style=display:flex;align-items:center;font-weight:700;color:#ffc107;margin-bottom:.5rem><span style=margin-right:.5rem>‚ö†Ô∏è</span>
<span>Pre-Release Software</span></div><div style=font-size:.875rem;color:#ffeb3b;line-height:1.4>This documentation is for unreleased software. Features and APIs may change before the official release.</div></div></div></div></aside><script src=/js/clipboard/clipboard.min.js?1770906066 defer></script><script src=/js/perfect-scrollbar/perfect-scrollbar.min.js?1770906066 defer></script><script src=/js/theme.min.js?1770906066 defer></script></body></html>