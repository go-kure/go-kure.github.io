<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.155.3"><meta name=generator content="Relearn 8.0.0+9803d5122ebb3276acea823f476e9eb44f607862"><meta name=description content='Layout Module The layout module is a sophisticated system for organizing and writing Kubernetes manifests to disk in directory structures that work with GitOps tools like Flux and ArgoCD.
Core Purpose The layout module transforms Kure‚Äôs in-memory stack representation (Clusters ‚Üí Nodes ‚Üí Bundles ‚Üí Applications) into organized directory structures with proper kustomization.yaml files that GitOps tools can consume.
Key Components 1. ManifestLayout Structure Central data structure representing a directory with its resources and children Contains: Name, Namespace, Resources (K8s objects), Children (subdirectories) Supports package-aware layouts for multi-OCI/Git scenarios 2. LayoutRules Configuration NodeGrouping: How nodes are organized (GroupByName creates dirs, GroupFlat flattens) BundleGrouping: How bundles within nodes are organized ApplicationGrouping: How applications within bundles are organized FilePer: How resources are written (FilePerResource vs FilePerKind) FluxPlacement: Where Flux Kustomizations go (FluxSeparate vs FluxIntegrated) 3. Two Main Walker Functions WalkCluster(): Standard hierarchical layout (Node ‚Üí Bundle ‚Üí App structure) WalkClusterByPackage(): Groups by PackageRef for multi-source scenarios 4. Writing System WriteManifest(): Standard hierarchical writing WritePackagesToDisk(): Package-based writing with sanitized directory names Auto-generates kustomization.yaml files with proper resource references Directory Structure Patterns Standard Layout (WalkCluster) clusters/ cluster-name/ node1/ bundle1/ app1/ manifest-files.yaml kustomization.yaml app2/... bundle2/... node2/... Package-Based Layout (WalkClusterByPackage) oci-packages/ cluster/ web/ app-manifests.yaml git-packages/ cluster/ monitoring/ app-manifests.yaml Flat Layout (GroupFlat rules) clusters/ cluster-name/ all-manifests-together.yaml kustomization.yaml GitOps Tool Compatibility Flux Integration Uses spec.path: ./clusters/cluster-name/node format Auto-generates kustomization.yaml files Supports recursive discovery of manifests Handles FluxSeparate vs FluxIntegrated placement modes ArgoCD Integration Uses spec.source.path: clusters/cluster-name/node format Requires explicit kustomization.yaml files (no auto-discovery) Each target directory needs its own Application Advanced Features Package Reference Support Tracks different source types (OCIRepository, GitRepository, Bucket) Enables multi-source deployments with proper isolation Sanitizes package keys into valid directory names Flexible File Organization FilePerResource: Each K8s object gets its own file FilePerKind: Group objects by Kind (all Services together, etc.) AppFileSingle: All app resources in one file Kustomization Generation KustomizationExplicit: Lists all manifest files explicitly KustomizationRecursive: References subdirectories only Smart handling of cross-references and child relationships Real-World Use Cases Simple Cluster: Single source, hierarchical structure Multi-OCI Deployment: Different services from different OCI registries Monorepo: Everything flattened into minimal directory structure Bootstrap Scenarios: Special handling for Flux/ArgoCD system components Example Usage // Create layout rules rules := layout.DefaultLayoutRules() rules.BundleGrouping = layout.GroupFlat rules.ApplicationGrouping = layout.GroupFlat // Walk cluster to create layout ml, err := layout.WalkCluster(cluster, rules) if err != nil { return err } // Write to disk cfg := layout.DefaultLayoutConfig() err = layout.WriteManifest("out/manifests", cfg, ml) Key Files types.go: Core types and configuration options walker.go: Tree traversal algorithms (WalkCluster, WalkClusterByPackage) manifest.go: ManifestLayout structure and package-based writing write.go: Standard manifest writing with kustomization generation config.go: Configuration and file naming conventions The layout module essentially bridges the gap between Kure‚Äôs programmatic resource construction and the file-based expectations of GitOps workflows, with extensive configurability for different organizational preferences and tool requirements.'><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Layout Engine :: Go Kure"><meta name=twitter:description content='Layout Module The layout module is a sophisticated system for organizing and writing Kubernetes manifests to disk in directory structures that work with GitOps tools like Flux and ArgoCD.
Core Purpose The layout module transforms Kure‚Äôs in-memory stack representation (Clusters ‚Üí Nodes ‚Üí Bundles ‚Üí Applications) into organized directory structures with proper kustomization.yaml files that GitOps tools can consume.
Key Components 1. ManifestLayout Structure Central data structure representing a directory with its resources and children Contains: Name, Namespace, Resources (K8s objects), Children (subdirectories) Supports package-aware layouts for multi-OCI/Git scenarios 2. LayoutRules Configuration NodeGrouping: How nodes are organized (GroupByName creates dirs, GroupFlat flattens) BundleGrouping: How bundles within nodes are organized ApplicationGrouping: How applications within bundles are organized FilePer: How resources are written (FilePerResource vs FilePerKind) FluxPlacement: Where Flux Kustomizations go (FluxSeparate vs FluxIntegrated) 3. Two Main Walker Functions WalkCluster(): Standard hierarchical layout (Node ‚Üí Bundle ‚Üí App structure) WalkClusterByPackage(): Groups by PackageRef for multi-source scenarios 4. Writing System WriteManifest(): Standard hierarchical writing WritePackagesToDisk(): Package-based writing with sanitized directory names Auto-generates kustomization.yaml files with proper resource references Directory Structure Patterns Standard Layout (WalkCluster) clusters/ cluster-name/ node1/ bundle1/ app1/ manifest-files.yaml kustomization.yaml app2/... bundle2/... node2/... Package-Based Layout (WalkClusterByPackage) oci-packages/ cluster/ web/ app-manifests.yaml git-packages/ cluster/ monitoring/ app-manifests.yaml Flat Layout (GroupFlat rules) clusters/ cluster-name/ all-manifests-together.yaml kustomization.yaml GitOps Tool Compatibility Flux Integration Uses spec.path: ./clusters/cluster-name/node format Auto-generates kustomization.yaml files Supports recursive discovery of manifests Handles FluxSeparate vs FluxIntegrated placement modes ArgoCD Integration Uses spec.source.path: clusters/cluster-name/node format Requires explicit kustomization.yaml files (no auto-discovery) Each target directory needs its own Application Advanced Features Package Reference Support Tracks different source types (OCIRepository, GitRepository, Bucket) Enables multi-source deployments with proper isolation Sanitizes package keys into valid directory names Flexible File Organization FilePerResource: Each K8s object gets its own file FilePerKind: Group objects by Kind (all Services together, etc.) AppFileSingle: All app resources in one file Kustomization Generation KustomizationExplicit: Lists all manifest files explicitly KustomizationRecursive: References subdirectories only Smart handling of cross-references and child relationships Real-World Use Cases Simple Cluster: Single source, hierarchical structure Multi-OCI Deployment: Different services from different OCI registries Monorepo: Everything flattened into minimal directory structure Bootstrap Scenarios: Special handling for Flux/ArgoCD system components Example Usage // Create layout rules rules := layout.DefaultLayoutRules() rules.BundleGrouping = layout.GroupFlat rules.ApplicationGrouping = layout.GroupFlat // Walk cluster to create layout ml, err := layout.WalkCluster(cluster, rules) if err != nil { return err } // Write to disk cfg := layout.DefaultLayoutConfig() err = layout.WriteManifest("out/manifests", cfg, ml) Key Files types.go: Core types and configuration options walker.go: Tree traversal algorithms (WalkCluster, WalkClusterByPackage) manifest.go: ManifestLayout structure and package-based writing write.go: Standard manifest writing with kustomization generation config.go: Configuration and file naming conventions The layout module essentially bridges the gap between Kure‚Äôs programmatic resource construction and the file-based expectations of GitOps workflows, with extensive configurability for different organizational preferences and tool requirements.'><meta property="og:url" content="https://www.gokure.dev/api-reference/layout/index.html"><meta property="og:site_name" content="Go Kure"><meta property="og:title" content="Layout Engine :: Go Kure"><meta property="og:description" content='Layout Module The layout module is a sophisticated system for organizing and writing Kubernetes manifests to disk in directory structures that work with GitOps tools like Flux and ArgoCD.
Core Purpose The layout module transforms Kure‚Äôs in-memory stack representation (Clusters ‚Üí Nodes ‚Üí Bundles ‚Üí Applications) into organized directory structures with proper kustomization.yaml files that GitOps tools can consume.
Key Components 1. ManifestLayout Structure Central data structure representing a directory with its resources and children Contains: Name, Namespace, Resources (K8s objects), Children (subdirectories) Supports package-aware layouts for multi-OCI/Git scenarios 2. LayoutRules Configuration NodeGrouping: How nodes are organized (GroupByName creates dirs, GroupFlat flattens) BundleGrouping: How bundles within nodes are organized ApplicationGrouping: How applications within bundles are organized FilePer: How resources are written (FilePerResource vs FilePerKind) FluxPlacement: Where Flux Kustomizations go (FluxSeparate vs FluxIntegrated) 3. Two Main Walker Functions WalkCluster(): Standard hierarchical layout (Node ‚Üí Bundle ‚Üí App structure) WalkClusterByPackage(): Groups by PackageRef for multi-source scenarios 4. Writing System WriteManifest(): Standard hierarchical writing WritePackagesToDisk(): Package-based writing with sanitized directory names Auto-generates kustomization.yaml files with proper resource references Directory Structure Patterns Standard Layout (WalkCluster) clusters/ cluster-name/ node1/ bundle1/ app1/ manifest-files.yaml kustomization.yaml app2/... bundle2/... node2/... Package-Based Layout (WalkClusterByPackage) oci-packages/ cluster/ web/ app-manifests.yaml git-packages/ cluster/ monitoring/ app-manifests.yaml Flat Layout (GroupFlat rules) clusters/ cluster-name/ all-manifests-together.yaml kustomization.yaml GitOps Tool Compatibility Flux Integration Uses spec.path: ./clusters/cluster-name/node format Auto-generates kustomization.yaml files Supports recursive discovery of manifests Handles FluxSeparate vs FluxIntegrated placement modes ArgoCD Integration Uses spec.source.path: clusters/cluster-name/node format Requires explicit kustomization.yaml files (no auto-discovery) Each target directory needs its own Application Advanced Features Package Reference Support Tracks different source types (OCIRepository, GitRepository, Bucket) Enables multi-source deployments with proper isolation Sanitizes package keys into valid directory names Flexible File Organization FilePerResource: Each K8s object gets its own file FilePerKind: Group objects by Kind (all Services together, etc.) AppFileSingle: All app resources in one file Kustomization Generation KustomizationExplicit: Lists all manifest files explicitly KustomizationRecursive: References subdirectories only Smart handling of cross-references and child relationships Real-World Use Cases Simple Cluster: Single source, hierarchical structure Multi-OCI Deployment: Different services from different OCI registries Monorepo: Everything flattened into minimal directory structure Bootstrap Scenarios: Special handling for Flux/ArgoCD system components Example Usage // Create layout rules rules := layout.DefaultLayoutRules() rules.BundleGrouping = layout.GroupFlat rules.ApplicationGrouping = layout.GroupFlat // Walk cluster to create layout ml, err := layout.WalkCluster(cluster, rules) if err != nil { return err } // Write to disk cfg := layout.DefaultLayoutConfig() err = layout.WriteManifest("out/manifests", cfg, ml) Key Files types.go: Core types and configuration options walker.go: Tree traversal algorithms (WalkCluster, WalkClusterByPackage) manifest.go: ManifestLayout structure and package-based writing write.go: Standard manifest writing with kustomization generation config.go: Configuration and file naming conventions The layout module essentially bridges the gap between Kure‚Äôs programmatic resource construction and the file-based expectations of GitOps workflows, with extensive configurability for different organizational preferences and tool requirements.'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="API Reference"><meta itemprop=name content="Layout Engine :: Go Kure"><meta itemprop=description content='Layout Module The layout module is a sophisticated system for organizing and writing Kubernetes manifests to disk in directory structures that work with GitOps tools like Flux and ArgoCD.
Core Purpose The layout module transforms Kure‚Äôs in-memory stack representation (Clusters ‚Üí Nodes ‚Üí Bundles ‚Üí Applications) into organized directory structures with proper kustomization.yaml files that GitOps tools can consume.
Key Components 1. ManifestLayout Structure Central data structure representing a directory with its resources and children Contains: Name, Namespace, Resources (K8s objects), Children (subdirectories) Supports package-aware layouts for multi-OCI/Git scenarios 2. LayoutRules Configuration NodeGrouping: How nodes are organized (GroupByName creates dirs, GroupFlat flattens) BundleGrouping: How bundles within nodes are organized ApplicationGrouping: How applications within bundles are organized FilePer: How resources are written (FilePerResource vs FilePerKind) FluxPlacement: Where Flux Kustomizations go (FluxSeparate vs FluxIntegrated) 3. Two Main Walker Functions WalkCluster(): Standard hierarchical layout (Node ‚Üí Bundle ‚Üí App structure) WalkClusterByPackage(): Groups by PackageRef for multi-source scenarios 4. Writing System WriteManifest(): Standard hierarchical writing WritePackagesToDisk(): Package-based writing with sanitized directory names Auto-generates kustomization.yaml files with proper resource references Directory Structure Patterns Standard Layout (WalkCluster) clusters/ cluster-name/ node1/ bundle1/ app1/ manifest-files.yaml kustomization.yaml app2/... bundle2/... node2/... Package-Based Layout (WalkClusterByPackage) oci-packages/ cluster/ web/ app-manifests.yaml git-packages/ cluster/ monitoring/ app-manifests.yaml Flat Layout (GroupFlat rules) clusters/ cluster-name/ all-manifests-together.yaml kustomization.yaml GitOps Tool Compatibility Flux Integration Uses spec.path: ./clusters/cluster-name/node format Auto-generates kustomization.yaml files Supports recursive discovery of manifests Handles FluxSeparate vs FluxIntegrated placement modes ArgoCD Integration Uses spec.source.path: clusters/cluster-name/node format Requires explicit kustomization.yaml files (no auto-discovery) Each target directory needs its own Application Advanced Features Package Reference Support Tracks different source types (OCIRepository, GitRepository, Bucket) Enables multi-source deployments with proper isolation Sanitizes package keys into valid directory names Flexible File Organization FilePerResource: Each K8s object gets its own file FilePerKind: Group objects by Kind (all Services together, etc.) AppFileSingle: All app resources in one file Kustomization Generation KustomizationExplicit: Lists all manifest files explicitly KustomizationRecursive: References subdirectories only Smart handling of cross-references and child relationships Real-World Use Cases Simple Cluster: Single source, hierarchical structure Multi-OCI Deployment: Different services from different OCI registries Monorepo: Everything flattened into minimal directory structure Bootstrap Scenarios: Special handling for Flux/ArgoCD system components Example Usage // Create layout rules rules := layout.DefaultLayoutRules() rules.BundleGrouping = layout.GroupFlat rules.ApplicationGrouping = layout.GroupFlat // Walk cluster to create layout ml, err := layout.WalkCluster(cluster, rules) if err != nil { return err } // Write to disk cfg := layout.DefaultLayoutConfig() err = layout.WriteManifest("out/manifests", cfg, ml) Key Files types.go: Core types and configuration options walker.go: Tree traversal algorithms (WalkCluster, WalkClusterByPackage) manifest.go: ManifestLayout structure and package-based writing write.go: Standard manifest writing with kustomization generation config.go: Configuration and file naming conventions The layout module essentially bridges the gap between Kure‚Äôs programmatic resource construction and the file-based expectations of GitOps workflows, with extensive configurability for different organizational preferences and tool requirements.'><meta itemprop=wordCount content="463"><title>Layout Engine :: Go Kure</title><link href=/css/auto-complete/auto-complete.min.css?1771251279 rel=stylesheet><script src=/js/auto-complete/auto-complete.min.js?1771251279 defer></script><script src=/js/search-lunr.min.js?1771251279 defer></script><script src=/js/search.min.js?1771251279 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/searchindex.en.js?1771251279"</script><script src=/js/lunr/lunr.min.js?1771251279 defer></script><script src=/js/lunr/lunr.stemmer.support.min.js?1771251279 defer></script><script src=/js/lunr/lunr.multi.min.js?1771251279 defer></script><script src=/js/lunr/lunr.en.min.js?1771251279 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/fonts/fontawesome/css/fontawesome-all.min.css?1771251279 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/fonts/fontawesome/css/fontawesome-all.min.css?1771251279 rel=stylesheet></noscript><link href=/css/perfect-scrollbar/perfect-scrollbar.min.css?1771251279 rel=stylesheet><link href=/css/theme.min.css?1771251279 rel=stylesheet><link href=/css/format-html.min.css?1771251279 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/api-reference/layout/index.html",window.relearn.relBasePath="../..",window.relearn.relBaseUri="../..",window.relearn.absBaseUri="https://www.gokure.dev",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["relearn-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><div class="notices warning" style=margin-bottom:1rem><div class=label>‚ö†Ô∏è Work in Progress</div><div class=content>Kure is currently under active development and has not been released yet. APIs and features are subject to change.</div></div></head><body class="mobile-support html" data-url=/api-reference/layout/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#core-purpose>Core Purpose</a></li><li><a href=#key-components>Key Components</a><ul><li><a href=#1-manifestlayout-structure>1. ManifestLayout Structure</a></li><li><a href=#2-layoutrules-configuration>2. LayoutRules Configuration</a></li><li><a href=#3-two-main-walker-functions>3. Two Main Walker Functions</a></li><li><a href=#4-writing-system>4. Writing System</a></li></ul></li><li><a href=#directory-structure-patterns>Directory Structure Patterns</a><ul><li><a href=#standard-layout-walkcluster>Standard Layout (WalkCluster)</a></li><li><a href=#package-based-layout-walkclusterbypackage>Package-Based Layout (WalkClusterByPackage)</a></li><li><a href=#flat-layout-groupflat-rules>Flat Layout (GroupFlat rules)</a></li></ul></li><li><a href=#gitops-tool-compatibility>GitOps Tool Compatibility</a><ul><li><a href=#flux-integration>Flux Integration</a></li><li><a href=#argocd-integration>ArgoCD Integration</a></li></ul></li><li><a href=#advanced-features>Advanced Features</a><ul><li><a href=#package-reference-support>Package Reference Support</a></li><li><a href=#flexible-file-organization>Flexible File Organization</a></li><li><a href=#kustomization-generation>Kustomization Generation</a></li></ul></li><li><a href=#real-world-use-cases>Real-World Use Cases</a></li><li><a href=#example-usage>Example Usage</a></li><li><a href=#key-files>Key Files</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>Go Kure</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/api-reference/index.html><span itemprop=name>API Reference</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Layout Engine</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/api-reference/generators/index.html title="Generators (ü°ê)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/api-reference/launcher/index.html title="Launcher (ü°í)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable api-reference" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=layout-engine>Layout Engine</h1><h1 id=layout-module>Layout Module</h1><p>The layout module is a sophisticated system for organizing and writing Kubernetes manifests to disk in directory structures that work with GitOps tools like Flux and ArgoCD.</p><h2 id=core-purpose>Core Purpose</h2><p>The layout module transforms Kure&rsquo;s in-memory stack representation (Clusters ‚Üí Nodes ‚Üí Bundles ‚Üí Applications) into organized directory structures with proper kustomization.yaml files that GitOps tools can consume.</p><h2 id=key-components>Key Components</h2><h3 id=1-manifestlayout-structure>1. ManifestLayout Structure</h3><ul><li>Central data structure representing a directory with its resources and children</li><li>Contains: Name, Namespace, Resources (K8s objects), Children (subdirectories)</li><li>Supports package-aware layouts for multi-OCI/Git scenarios</li></ul><h3 id=2-layoutrules-configuration>2. LayoutRules Configuration</h3><ul><li><strong>NodeGrouping</strong>: How nodes are organized (GroupByName creates dirs, GroupFlat flattens)</li><li><strong>BundleGrouping</strong>: How bundles within nodes are organized</li><li><strong>ApplicationGrouping</strong>: How applications within bundles are organized</li><li><strong>FilePer</strong>: How resources are written (FilePerResource vs FilePerKind)</li><li><strong>FluxPlacement</strong>: Where Flux Kustomizations go (FluxSeparate vs FluxIntegrated)</li></ul><h3 id=3-two-main-walker-functions>3. Two Main Walker Functions</h3><ul><li><strong>WalkCluster()</strong>: Standard hierarchical layout (Node ‚Üí Bundle ‚Üí App structure)</li><li><strong>WalkClusterByPackage()</strong>: Groups by PackageRef for multi-source scenarios</li></ul><h3 id=4-writing-system>4. Writing System</h3><ul><li><strong>WriteManifest()</strong>: Standard hierarchical writing</li><li><strong>WritePackagesToDisk()</strong>: Package-based writing with sanitized directory names</li><li>Auto-generates kustomization.yaml files with proper resource references</li></ul><h2 id=directory-structure-patterns>Directory Structure Patterns</h2><h3 id=standard-layout-walkcluster>Standard Layout (WalkCluster)</h3><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>clusters/
  cluster-name/
    node1/
      bundle1/
        app1/
          manifest-files.yaml
          kustomization.yaml
        app2/...
      bundle2/...
    node2/...</code></pre></div><h3 id=package-based-layout-walkclusterbypackage>Package-Based Layout (WalkClusterByPackage)</h3><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>oci-packages/
  cluster/
    web/
      app-manifests.yaml
git-packages/
  cluster/
    monitoring/
      app-manifests.yaml</code></pre></div><h3 id=flat-layout-groupflat-rules>Flat Layout (GroupFlat rules)</h3><div class="highlight wrap-code" dir=auto><pre tabindex=0><code>clusters/
  cluster-name/
    all-manifests-together.yaml
    kustomization.yaml</code></pre></div><h2 id=gitops-tool-compatibility>GitOps Tool Compatibility</h2><h3 id=flux-integration>Flux Integration</h3><ul><li>Uses <code>spec.path: ./clusters/cluster-name/node</code> format</li><li>Auto-generates kustomization.yaml files</li><li>Supports recursive discovery of manifests</li><li>Handles FluxSeparate vs FluxIntegrated placement modes</li></ul><h3 id=argocd-integration>ArgoCD Integration</h3><ul><li>Uses <code>spec.source.path: clusters/cluster-name/node</code> format</li><li>Requires explicit kustomization.yaml files (no auto-discovery)</li><li>Each target directory needs its own Application</li></ul><h2 id=advanced-features>Advanced Features</h2><h3 id=package-reference-support>Package Reference Support</h3><ul><li>Tracks different source types (OCIRepository, GitRepository, Bucket)</li><li>Enables multi-source deployments with proper isolation</li><li>Sanitizes package keys into valid directory names</li></ul><h3 id=flexible-file-organization>Flexible File Organization</h3><ul><li><strong>FilePerResource</strong>: Each K8s object gets its own file</li><li><strong>FilePerKind</strong>: Group objects by Kind (all Services together, etc.)</li><li><strong>AppFileSingle</strong>: All app resources in one file</li></ul><h3 id=kustomization-generation>Kustomization Generation</h3><ul><li><strong>KustomizationExplicit</strong>: Lists all manifest files explicitly</li><li><strong>KustomizationRecursive</strong>: References subdirectories only</li><li>Smart handling of cross-references and child relationships</li></ul><h2 id=real-world-use-cases>Real-World Use Cases</h2><ol><li><strong>Simple Cluster</strong>: Single source, hierarchical structure</li><li><strong>Multi-OCI Deployment</strong>: Different services from different OCI registries</li><li><strong>Monorepo</strong>: Everything flattened into minimal directory structure</li><li><strong>Bootstrap Scenarios</strong>: Special handling for Flux/ArgoCD system components</li></ol><h2 id=example-usage>Example Usage</h2><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Create layout rules</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>rules</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>layout</span>.<span style=color:#a6e22e>DefaultLayoutRules</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>rules</span>.<span style=color:#a6e22e>BundleGrouping</span> = <span style=color:#a6e22e>layout</span>.<span style=color:#a6e22e>GroupFlat</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>rules</span>.<span style=color:#a6e22e>ApplicationGrouping</span> = <span style=color:#a6e22e>layout</span>.<span style=color:#a6e22e>GroupFlat</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Walk cluster to create layout</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ml</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>layout</span>.<span style=color:#a6e22e>WalkCluster</span>(<span style=color:#a6e22e>cluster</span>, <span style=color:#a6e22e>rules</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Write to disk</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>cfg</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>layout</span>.<span style=color:#a6e22e>DefaultLayoutConfig</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>layout</span>.<span style=color:#a6e22e>WriteManifest</span>(<span style=color:#e6db74>&#34;out/manifests&#34;</span>, <span style=color:#a6e22e>cfg</span>, <span style=color:#a6e22e>ml</span>)</span></span></code></pre></div><h2 id=key-files>Key Files</h2><ul><li><strong>types.go</strong>: Core types and configuration options</li><li><strong>walker.go</strong>: Tree traversal algorithms (WalkCluster, WalkClusterByPackage)</li><li><strong>manifest.go</strong>: ManifestLayout structure and package-based writing</li><li><strong>write.go</strong>: Standard manifest writing with kustomization generation</li><li><strong>config.go</strong>: Configuration and file naming conventions</li></ul><p>The layout module essentially bridges the gap between Kure&rsquo;s programmatic resource construction and the file-based expectations of GitOps workflows, with extensive configurability for different organizational preferences and tool requirements.</p><footer class=footline></footer></article></div></main></div><aside id=R-sidebar class=default-animation><div id=R-header-topbar class=default-animation></div><div id=R-header-wrapper class=default-animation><div id=R-header class=default-animation><a href=https://www.gokure.dev/ style=text-decoration:none><h1 style=margin:0;padding:1rem;color:var(--MENU-SECTIONS-ACTIVE-BG-color)>Go Kure</h1></a></div><search><form action=/search/index.html method=get><div class="searchbox default-animation"><button class=search-detail type=submit title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
<label class=a11y-only for=R-search-by>Search</label>
<input data-search-input id=R-search-by name=search-by class=search-by type=search placeholder=Search...>
<button class=search-clear type=button data-search-clear title="Clear search"><i class="fas fa-times" title="Clear search"></i></button></div></form></search></div><div id=R-homelinks class="default-animation homelinks"><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-homelinks"><ul class="space collapsible-menu"><li data-nav-id=/index.html><a class=padding href=/index.html><i class="fa-fw fas fa-home"></i> Home</a></li></ul></div><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-headercontrols"><ul></ul></div><div class="R-menu-divider default-animation"><hr class=padding></div></div><div id=R-content-wrapper class=highlightable><div class="R-sidebarmenu R-shortcutmenu-main"><ul class="enlarge morespace collapsible-menu"><li data-nav-id=/getting-started/index.html><a class=padding href=/getting-started/index.html>Getting Started</a><ul id=R-subsections-87c0363912f379e0725cbe1d504c985c class=collapsible-menu></ul></li><li data-nav-id=/concepts/index.html><a class=padding href=/concepts/index.html>Concepts</a><ul id=R-subsections-90941c33b457a4d12ffdbc0aa62a266d class=collapsible-menu></ul></li><li data-nav-id=/guides/index.html><a class=padding href=/guides/index.html>Guides</a><ul id=R-subsections-8fc2fd7736125e87cab8840a86c2af5a class=collapsible-menu></ul></li><li data-nav-id=/examples/index.html><a class=padding href=/examples/index.html>Examples</a><ul id=R-subsections-2e4187ca04853a7e1382c8d86f7be6fd class=collapsible-menu></ul></li><li data-nav-id=/cli-reference/index.html><a class=padding href=/cli-reference/index.html>CLI Reference</a></li><li class=parent data-nav-id=/api-reference/index.html><a class=padding href=/api-reference/index.html>API Reference</a><ul id=R-subsections-dd202aa4390a9811c67d06158c5ff213 class=collapsible-menu><li data-nav-id=/api-reference/stack/index.html><a class=padding href=/api-reference/stack/index.html>Stack</a></li><li data-nav-id=/api-reference/flux-engine/index.html><a class=padding href=/api-reference/flux-engine/index.html>Flux Engine</a></li><li data-nav-id=/api-reference/generators/index.html><a class=padding href=/api-reference/generators/index.html>Generators</a></li><li class=active data-nav-id=/api-reference/layout/index.html><a class=padding href=/api-reference/layout/index.html>Layout Engine</a></li><li data-nav-id=/api-reference/launcher/index.html><a class=padding href=/api-reference/launcher/index.html>Launcher</a></li><li data-nav-id=/api-reference/patch/index.html><a class=padding href=/api-reference/patch/index.html>Patch</a></li><li data-nav-id=/api-reference/io/index.html><a class=padding href=/api-reference/io/index.html>IO</a></li><li data-nav-id=/api-reference/errors/index.html><a class=padding href=/api-reference/errors/index.html>Errors</a></li><li data-nav-id=/api-reference/cli/index.html><a class=padding href=/api-reference/cli/index.html>CLI Utilities</a></li><li data-nav-id=/api-reference/kubernetes-builders/index.html><a class=padding href=/api-reference/kubernetes-builders/index.html>Kubernetes Builders</a></li><li data-nav-id=/api-reference/fluxcd-builders/index.html><a class=padding href=/api-reference/fluxcd-builders/index.html>FluxCD Builders</a></li><li data-nav-id=/api-reference/logger/index.html><a class=padding href=/api-reference/logger/index.html>Logger</a></li><li data-nav-id=/api-reference/compatibility/index.html><a class=padding href=/api-reference/compatibility/index.html>Compatibility Matrix</a></li></ul></li><li data-nav-id=/changelog/index.html><a class=padding href=/changelog/index.html>Changelog</a><ul id=R-subsections-d1977150cf385e06b32490e43a8e612b class=collapsible-menu></ul></li><li data-nav-id=/contributing/index.html><a class=padding href=/contributing/index.html>Contributing</a><ul id=R-subsections-0d02badb7422c7536b9ac4528048a4b1 class=collapsible-menu></ul></li></ul></div><div class="R-sidebarmenu R-shortcutmenu-shortcuts"><ul class="space collapsible-menu"></ul></div><div id=R-footer-margin></div><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-footercontrols"><ul></ul></div><div id=R-footer></div></div></aside><script src=/js/clipboard/clipboard.min.js?1771251279 defer></script><script src=/js/perfect-scrollbar/perfect-scrollbar.min.js?1771251279 defer></script><script src=/js/theme.min.js?1771251279 defer></script></body></html>