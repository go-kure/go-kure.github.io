<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.155.3"><meta name=generator content="Relearn 8.0.0+9803d5122ebb3276acea823f476e9eb44f607862"><meta name=description content="Patch - Declarative Resource Patching The patch package provides a JSONPath-based system for declaratively modifying Kubernetes resources. It supports both TOML and YAML patch file formats with structure-preserving modifications and variable substitution.
Overview Patches allow you to modify Kubernetes manifests without rewriting them. The system uses JSONPath expressions to target specific fields and applies changes while preserving the original YAML structure (comments, ordering, formatting)."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Patch :: Go Kure"><meta name=twitter:description content="Patch - Declarative Resource Patching The patch package provides a JSONPath-based system for declaratively modifying Kubernetes resources. It supports both TOML and YAML patch file formats with structure-preserving modifications and variable substitution.
Overview Patches allow you to modify Kubernetes manifests without rewriting them. The system uses JSONPath expressions to target specific fields and applies changes while preserving the original YAML structure (comments, ordering, formatting)."><meta property="og:url" content="https://www.gokure.dev/dev/api-reference/patch/index.html"><meta property="og:site_name" content="Go Kure"><meta property="og:title" content="Patch :: Go Kure"><meta property="og:description" content="Patch - Declarative Resource Patching The patch package provides a JSONPath-based system for declaratively modifying Kubernetes resources. It supports both TOML and YAML patch file formats with structure-preserving modifications and variable substitution.
Overview Patches allow you to modify Kubernetes manifests without rewriting them. The system uses JSONPath expressions to target specific fields and applies changes while preserving the original YAML structure (comments, ordering, formatting)."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="API Reference"><meta itemprop=name content="Patch :: Go Kure"><meta itemprop=description content="Patch - Declarative Resource Patching The patch package provides a JSONPath-based system for declaratively modifying Kubernetes resources. It supports both TOML and YAML patch file formats with structure-preserving modifications and variable substitution.
Overview Patches allow you to modify Kubernetes manifests without rewriting them. The system uses JSONPath expressions to target specific fields and applies changes while preserving the original YAML structure (comments, ordering, formatting)."><meta itemprop=wordCount content="476"><title>Patch :: Go Kure</title><link href=/dev/css/auto-complete/auto-complete.min.css?1771604504 rel=stylesheet><script src=/dev/js/auto-complete/auto-complete.min.js?1771604504 defer></script><script src=/dev/js/search-lunr.min.js?1771604504 defer></script><script src=/dev/js/search.min.js?1771604504 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/dev/searchindex.en.js?1771604504"</script><script src=/dev/js/lunr/lunr.min.js?1771604504 defer></script><script src=/dev/js/lunr/lunr.stemmer.support.min.js?1771604504 defer></script><script src=/dev/js/lunr/lunr.multi.min.js?1771604504 defer></script><script src=/dev/js/lunr/lunr.en.min.js?1771604504 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/dev/fonts/fontawesome/css/fontawesome-all.min.css?1771604504 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/dev/fonts/fontawesome/css/fontawesome-all.min.css?1771604504 rel=stylesheet></noscript><link href=/dev/css/perfect-scrollbar/perfect-scrollbar.min.css?1771604504 rel=stylesheet><link href=/dev/css/theme.min.css?1771604504 rel=stylesheet><link href=/dev/css/format-html.min.css?1771604504 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/api-reference/patch/index.html",window.relearn.relBasePath="../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://www.gokure.dev/dev",window.relearn.version_js_url="/dev/versionindex.en.js?1771604504",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy to clipboard`,window.T_Copied_to_clipboard=`Copied to clipboard!`,window.T_Copy_link_to_clipboard=`Copy link to clipboard`,window.T_Link_copied_to_clipboard=`Copied link to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.relearn.themevariants=["relearn-dark"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><div class="notices warning" style=margin-bottom:1rem><div class=label>‚ö†Ô∏è Work in Progress</div><div class=content>You are viewing <strong>development</strong> documentation built from the latest commit on <code>main</code>. APIs and features are subject to change.</div></div></head><body class="mobile-support html" data-url=/dev/api-reference/patch/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#patch-file-formats>Patch File Formats</a><ul><li><a href=#toml-format-kpatch>TOML Format (<code>.kpatch</code>)</a></li><li><a href=#yaml-format>YAML Format</a></li></ul></li><li><a href=#quick-start>Quick Start</a></li><li><a href=#key-features>Key Features</a><ul><li><a href=#variable-substitution>Variable Substitution</a></li><li><a href=#list-selectors>List Selectors</a></li><li><a href=#structure-preservation>Structure Preservation</a></li><li><a href=#strategic-merge-patch>Strategic Merge Patch</a></li></ul></li><li><a href=#api-reference>API Reference</a><ul><li><a href=#loading-patches>Loading Patches</a></li><li><a href=#applying-patches>Applying Patches</a></li><li><a href=#strategic-merge-patch-1>Strategic Merge Patch</a></li></ul></li><li><a href=#related-packages>Related Packages</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/dev/index.html><span itemprop=name>Go Kure</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/dev/api-reference/index.html><span itemprop=name>API Reference</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Patch</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/dev/api-reference/launcher/index.html title="Launcher (ü°ê)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=/dev/api-reference/io/index.html title="IO (ü°í)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable api-reference" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=patch>Patch</h1><h1 id=patch---declarative-resource-patching>Patch - Declarative Resource Patching</h1><p><a href=https://pkg.go.dev/github.com/go-kure/kure/pkg/patch target=_blank rel=noopener><a href=#R-image-7ea35bd4315bb1894e79ec50bd1a877c class=lightbox-link><img alt="Go Reference" class="lazy lightbox figure-image" loading=lazy src=https://pkg.go.dev/badge/github.com/go-kure/kure/pkg/patch.svg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-7ea35bd4315bb1894e79ec50bd1a877c><img alt="Go Reference" class="lazy lightbox lightbox-image" loading=lazy src=https://pkg.go.dev/badge/github.com/go-kure/kure/pkg/patch.svg></a></a></p><p>The <code>patch</code> package provides a JSONPath-based system for declaratively modifying Kubernetes resources. It supports both TOML and YAML patch file formats with structure-preserving modifications and variable substitution.</p><h2 id=overview>Overview</h2><p>Patches allow you to modify Kubernetes manifests without rewriting them. The system uses JSONPath expressions to target specific fields and applies changes while preserving the original YAML structure (comments, ordering, formatting).</p><h2 id=patch-file-formats>Patch File Formats</h2><h3 id=toml-format-kpatch>TOML Format (<code>.kpatch</code>)</h3><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#75715e># Target a specific resource by kind and name</span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>deployment</span>.<span style=color:#a6e22e>myapp</span>.<span style=color:#a6e22e>spec</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>replicas</span> = <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>deployment</span>.<span style=color:#a6e22e>myapp</span>.<span style=color:#a6e22e>spec</span>.<span style=color:#a6e22e>template</span>.<span style=color:#a6e22e>spec</span>.<span style=color:#a6e22e>containers</span>.<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>image</span> = <span style=color:#e6db74>&#34;${app.image}:${app.tag}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>resources</span>.<span style=color:#a6e22e>requests</span>.<span style=color:#a6e22e>cpu</span> = <span style=color:#e6db74>&#34;200m&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>resources</span>.<span style=color:#a6e22e>requests</span>.<span style=color:#a6e22e>memory</span> = <span style=color:#e6db74>&#34;256Mi&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Append to a list with .-</span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>deployment</span>.<span style=color:#a6e22e>myapp</span>.<span style=color:#a6e22e>spec</span>.<span style=color:#a6e22e>template</span>.<span style=color:#a6e22e>spec</span>.<span style=color:#a6e22e>containers</span>.<span style=color:#a6e22e>-</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;sidecar&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>image</span> = <span style=color:#e6db74>&#34;envoy:latest&#34;</span></span></span></code></pre></div><h3 id=yaml-format>YAML Format</h3><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>target</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>myapp</span>
</span></span><span style=display:flex><span><span style=color:#f92672>patches</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>spec.replicas</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>value</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>spec.template.spec.containers[0].image</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;nginx:latest&#34;</span></span></span></code></pre></div><h2 id=quick-start>Quick Start</h2><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;github.com/go-kure/kure/pkg/patch&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Load patches from file</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>file</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#e6db74>&#34;patches/customize.kpatch&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>specs</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>LoadPatchFile</span>(<span style=color:#a6e22e>file</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Create patchable set with resources and patches</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>patchSet</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>NewPatchableAppSet</span>(<span style=color:#a6e22e>resources</span>, <span style=color:#a6e22e>specs</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Resolve targets and apply</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>resolved</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>patchSet</span>.<span style=color:#a6e22e>Resolve</span>()
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>resolved</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Apply</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Write patched output</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>patchSet</span>.<span style=color:#a6e22e>WriteToFile</span>(<span style=color:#e6db74>&#34;output.yaml&#34;</span>)</span></span></code></pre></div><h2 id=key-features>Key Features</h2><h3 id=variable-substitution>Variable Substitution</h3><p>Patches support variable references that resolve against a parameter context:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-toml data-lang=toml><span style=display:flex><span>[<span style=color:#a6e22e>deployment</span>.<span style=color:#a6e22e>myapp</span>.<span style=color:#a6e22e>spec</span>.<span style=color:#a6e22e>template</span>.<span style=color:#a6e22e>spec</span>.<span style=color:#a6e22e>containers</span>.<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>image</span> = <span style=color:#e6db74>&#34;${registry}/${image}:${tag}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>replicas</span> = <span style=color:#e6db74>&#34;${replicas}&#34;</span></span></span></code></pre></div><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>varCtx</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>VariableContext</span>{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Variables</span>: <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}{
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;registry&#34;</span>: <span style=color:#e6db74>&#34;docker.io&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;image&#34;</span>:    <span style=color:#e6db74>&#34;myapp&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;tag&#34;</span>:      <span style=color:#e6db74>&#34;v1.0.0&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;replicas&#34;</span>: <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>specs</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>LoadPatchFileWithVariables</span>(<span style=color:#a6e22e>file</span>, <span style=color:#a6e22e>varCtx</span>)</span></span></code></pre></div><h3 id=list-selectors>List Selectors</h3><p>Target specific items in lists using selectors:</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-toml data-lang=toml><span style=display:flex><span><span style=color:#75715e># By index</span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>deployment</span>.<span style=color:#a6e22e>myapp</span>.<span style=color:#a6e22e>spec</span>.<span style=color:#a6e22e>template</span>.<span style=color:#a6e22e>spec</span>.<span style=color:#a6e22e>containers</span>.<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>image</span> = <span style=color:#e6db74>&#34;updated:latest&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Append to list</span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>deployment</span>.<span style=color:#a6e22e>myapp</span>.<span style=color:#a6e22e>spec</span>.<span style=color:#a6e22e>template</span>.<span style=color:#a6e22e>spec</span>.<span style=color:#a6e22e>containers</span>.<span style=color:#a6e22e>-</span>]
</span></span><span style=display:flex><span><span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;new-container&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># By field value (name selector)</span>
</span></span><span style=display:flex><span>[<span style=color:#a6e22e>deployment</span>.<span style=color:#a6e22e>myapp</span>.<span style=color:#a6e22e>spec</span>.<span style=color:#a6e22e>template</span>.<span style=color:#a6e22e>spec</span>.<span style=color:#a6e22e>containers</span>.{<span style=color:#a6e22e>name</span>=<span style=color:#a6e22e>myapp</span>}]
</span></span><span style=display:flex><span><span style=color:#a6e22e>image</span> = <span style=color:#e6db74>&#34;updated:latest&#34;</span></span></span></code></pre></div><h3 id=structure-preservation>Structure Preservation</h3><p>When using <code>NewPatchableAppSetWithStructure</code>, the original YAML document structure is preserved through patching, maintaining comments, key ordering, and formatting.</p><h3 id=strategic-merge-patch>Strategic Merge Patch</h3><p>For broad document-level changes, strategic merge patch (SMP) deep-merges a partial YAML document into the target resource. Known Kubernetes kinds merge lists by key (e.g. containers by <code>name</code>); unknown kinds fall back to JSON merge patch (RFC 7386).</p><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>target</span>: <span style=color:#ae81ff>deployment.my-app</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>strategic</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>patch</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>main</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;500m&#34;</span>
</span></span><span style=display:flex><span>          - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>sidecar</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>image</span>: <span style=color:#ae81ff>envoy:v1.28</span></span></span></code></pre></div><div class="highlight wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Enable kind-aware merging</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>lookup</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>patch</span>.<span style=color:#a6e22e>DefaultKindLookup</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>patchSet</span>.<span style=color:#a6e22e>KindLookup</span> = <span style=color:#a6e22e>lookup</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Detect conflicts before applying</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>resolved</span>, <span style=color:#a6e22e>reports</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>patchSet</span>.<span style=color:#a6e22e>ResolveWithConflictCheck</span>()</span></span></code></pre></div><p>SMP patches are applied before field-level patches. See <a href=https://github.com/go-kure/kure/blob/main/pkg/patch/DESIGN.md target=_blank rel=noopener>DESIGN.md</a>
for full specification.</p><h2 id=api-reference>API Reference</h2><h3 id=loading-patches>Loading Patches</h3><table><thead><tr><th>Function</th><th>Description</th></tr></thead><tbody><tr><td><code>LoadPatchFile(r)</code></td><td>Load with automatic format detection</td></tr><tr><td><code>LoadPatchFileWithVariables(r, ctx)</code></td><td>Load with variable substitution</td></tr><tr><td><code>LoadTOMLPatchFile(r, ctx)</code></td><td>Load TOML-format patches</td></tr><tr><td><code>LoadYAMLPatchFile(r, ctx)</code></td><td>Load YAML-format patches</td></tr></tbody></table><h3 id=applying-patches>Applying Patches</h3><table><thead><tr><th>Function</th><th>Description</th></tr></thead><tbody><tr><td><code>NewPatchableAppSet(resources, patches)</code></td><td>Create patchable set</td></tr><tr><td><code>NewPatchableAppSetWithStructure(docSet, patches)</code></td><td>Create with structure preservation</td></tr><tr><td><code>ParsePatchLine(path, value)</code></td><td>Parse a single patch operation</td></tr></tbody></table><h3 id=strategic-merge-patch-1>Strategic Merge Patch</h3><table><thead><tr><th>Function</th><th>Description</th></tr></thead><tbody><tr><td><code>ApplyStrategicMergePatch(resource, patch, lookup)</code></td><td>Apply SMP to a single resource</td></tr><tr><td><code>DefaultKindLookup()</code></td><td>Create a KindLookup from the built-in scheme</td></tr><tr><td><code>DetectSMPConflicts(patches, lookup, gvk)</code></td><td>Check pairwise conflicts among patches</td></tr><tr><td><code>ResolveWithConflictCheck()</code></td><td>Resolve patches with conflict detection</td></tr></tbody></table><h2 id=related-packages>Related Packages</h2><ul><li><a href=../launcher/>launcher</a>
- Uses patches in kurel package system</li><li><a href=../io/>io</a>
- YAML parsing for patch targets</li></ul><footer class=footline></footer></article></div></main></div><aside id=R-sidebar class=default-animation><div id=R-header-topbar class=default-animation></div><div id=R-header-wrapper class=default-animation><div id=R-header class=default-animation><a href=https://www.gokure.dev/dev/ style=text-decoration:none><h1 style=margin:0;padding:1rem;color:var(--MENU-SECTIONS-ACTIVE-BG-color)>Go Kure
<span style=font-size:.5em;vertical-align:middle;opacity:.7>(dev)</span></h1></a></div><search><form action=/dev/search/index.html method=get><div class="searchbox default-animation"><button class=search-detail type=submit title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
<label class=a11y-only for=R-search-by>Search</label>
<input data-search-input id=R-search-by name=search-by class=search-by type=search placeholder=Search...>
<button class=search-clear type=button data-search-clear title="Clear search"><i class="fas fa-times" title="Clear search"></i></button></div></form></search></div><div id=R-homelinks class="default-animation homelinks"><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-homelinks"><ul class="space collapsible-menu"><li data-nav-id=/dev/index.html><a class=padding href=/dev/index.html><i class="fa-fw fas fa-home"></i> Home</a></li></ul></div><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-headercontrols"><ul><li class=R-versionswitcher><div class="padding menu-control"><i class="fa-fw fas fa-code-branch"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=R-select-version></label><select id=R-select-version><option id=R-select-version-dev value=dev data-identifier=dev data-abs=true data-uri=https://www.gokure.dev/dev selected data-selected>Development</option></select></div><div class=clear></div></div></li></ul></div><div class="R-menu-divider default-animation"><hr class=padding></div></div><div id=R-content-wrapper class=highlightable><div class="R-sidebarmenu R-shortcutmenu-main"><ul class="enlarge morespace collapsible-menu"><li data-nav-id=/dev/getting-started/index.html><a class=padding href=/dev/getting-started/index.html>Getting Started</a><ul id=R-subsections-87c0363912f379e0725cbe1d504c985c class=collapsible-menu></ul></li><li data-nav-id=/dev/concepts/index.html><a class=padding href=/dev/concepts/index.html>Concepts</a><ul id=R-subsections-90941c33b457a4d12ffdbc0aa62a266d class=collapsible-menu></ul></li><li data-nav-id=/dev/guides/index.html><a class=padding href=/dev/guides/index.html>Guides</a><ul id=R-subsections-8fc2fd7736125e87cab8840a86c2af5a class=collapsible-menu></ul></li><li data-nav-id=/dev/examples/index.html><a class=padding href=/dev/examples/index.html>Examples</a><ul id=R-subsections-2e4187ca04853a7e1382c8d86f7be6fd class=collapsible-menu></ul></li><li data-nav-id=/dev/cli-reference/index.html><a class=padding href=/dev/cli-reference/index.html>CLI Reference</a><ul id=R-subsections-885bd25489244ef6ea265d76f542112b class=collapsible-menu></ul></li><li class=parent data-nav-id=/dev/api-reference/index.html><a class=padding href=/dev/api-reference/index.html>API Reference</a><ul id=R-subsections-dd202aa4390a9811c67d06158c5ff213 class=collapsible-menu><li data-nav-id=/dev/api-reference/stack/index.html><a class=padding href=/dev/api-reference/stack/index.html>Stack</a></li><li data-nav-id=/dev/api-reference/flux-engine/index.html><a class=padding href=/dev/api-reference/flux-engine/index.html>Flux Engine</a></li><li data-nav-id=/dev/api-reference/generators/index.html><a class=padding href=/dev/api-reference/generators/index.html>Generators</a></li><li data-nav-id=/dev/api-reference/layout/index.html><a class=padding href=/dev/api-reference/layout/index.html>Layout Engine</a></li><li data-nav-id=/dev/api-reference/launcher/index.html><a class=padding href=/dev/api-reference/launcher/index.html>Launcher</a></li><li class=active data-nav-id=/dev/api-reference/patch/index.html><a class=padding href=/dev/api-reference/patch/index.html>Patch</a></li><li data-nav-id=/dev/api-reference/io/index.html><a class=padding href=/dev/api-reference/io/index.html>IO</a></li><li data-nav-id=/dev/api-reference/errors/index.html><a class=padding href=/dev/api-reference/errors/index.html>Errors</a></li><li data-nav-id=/dev/api-reference/cli/index.html><a class=padding href=/dev/api-reference/cli/index.html>CLI Utilities</a></li><li data-nav-id=/dev/api-reference/kubernetes-builders/index.html><a class=padding href=/dev/api-reference/kubernetes-builders/index.html>Kubernetes Builders</a></li><li data-nav-id=/dev/api-reference/fluxcd-builders/index.html><a class=padding href=/dev/api-reference/fluxcd-builders/index.html>FluxCD Builders</a></li><li data-nav-id=/dev/api-reference/logger/index.html><a class=padding href=/dev/api-reference/logger/index.html>Logger</a></li><li data-nav-id=/dev/api-reference/compatibility/index.html><a class=padding href=/dev/api-reference/compatibility/index.html>Compatibility Matrix</a></li></ul></li><li data-nav-id=/dev/changelog/index.html><a class=padding href=/dev/changelog/index.html>Changelog</a><ul id=R-subsections-d1977150cf385e06b32490e43a8e612b class=collapsible-menu></ul></li><li data-nav-id=/dev/contributing/index.html><a class=padding href=/dev/contributing/index.html>Contributing</a><ul id=R-subsections-0d02badb7422c7536b9ac4528048a4b1 class=collapsible-menu></ul></li></ul></div><div class="R-sidebarmenu R-shortcutmenu-shortcuts"><ul class="space collapsible-menu"></ul></div><div id=R-footer-margin></div><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-footercontrols"><ul></ul></div><div id=R-footer></div></div></aside><script src=/dev/js/clipboard/clipboard.min.js?1771604504 defer></script><script src=/dev/js/perfect-scrollbar/perfect-scrollbar.min.js?1771604504 defer></script><script src=/dev/js/theme.min.js?1771604504 defer></script></body></html>